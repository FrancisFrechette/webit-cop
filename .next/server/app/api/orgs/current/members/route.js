"use strict";(()=>{var e={};e.id=3334,e.ids=[3334],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3263:e=>{e.exports=import("firebase-admin/app")},79637:e=>{e.exports=import("firebase-admin/auth")},72929:e=>{e.exports=import("firebase-admin/firestore")},43910:(e,r,t)=>{t.a(e,async(e,s)=>{try{t.r(r),t.d(r,{originalPathname:()=>g,patchFetch:()=>p,requestAsyncStorage:()=>d,routeModule:()=>m,serverHooks:()=>l,staticGenerationAsyncStorage:()=>c});var n=t(49303),o=t(88716),a=t(60670),i=t(19503),u=e([i]);i=(u.then?(await u)():u)[0];let m=new n.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/orgs/current/members/route",pathname:"/api/orgs/current/members",filename:"route",bundlePath:"app/api/orgs/current/members/route"},resolvedPagePath:"C:\\Projets - Developpement\\cursor-webit-cop\\app\\api\\orgs\\current\\members\\route.ts",nextConfigOutput:"",userland:i}),{requestAsyncStorage:d,staticGenerationAsyncStorage:c,serverHooks:l}=m,g="/api/orgs/current/members/route";function p(){return(0,a.patchFetch)({serverHooks:l,staticGenerationAsyncStorage:c})}s()}catch(e){s(e)}})},19503:(e,r,t)=>{t.a(e,async(e,s)=>{try{t.r(r),t.d(r,{GET:()=>m,POST:()=>d});var n=t(87070),o=t(90455),a=t(76899),i=t(25371),u=t(7331),p=e([o,u]);async function m(){try{let e=await (0,o.$9)(),r=(0,i.Fs)(e.permissions,"org.manage_members"),t="owner"===e.orgRole||"admin"===e.orgRole;if(!r&&!t)return n.NextResponse.json({error:"Forbidden: missing permission org.manage_members"},{status:403});let s=await (0,u.Xu)(e.orgId);if(!s)return n.NextResponse.json({error:"Organisation non trouv\xe9e"},{status:404});let a=s.members??[];return n.NextResponse.json({members:a})}catch(r){let e=(0,a.s)(r);if(e)return e;throw r}}async function d(e){try{let r;let t=await (0,o.$9)();(0,o.Ql)(t,"org.manage_members");try{r=await e.json()}catch{return n.NextResponse.json({error:"Body JSON invalide"},{status:400})}let{userEmail:s,role:a}=r;if(!s?.trim())return n.NextResponse.json({error:"userEmail obligatoire"},{status:400});if(!a||!["owner","admin","editor","author","viewer"].includes(a))return n.NextResponse.json({error:"role invalide"},{status:400});let i=await (0,u.Xu)(t.orgId);if(!i)return n.NextResponse.json({error:"Organisation non trouv\xe9e"},{status:404});let p=[...i.members??[]],m=s.trim().toLowerCase(),d=p.findIndex(e=>e.userEmail.toLowerCase()===m||e.userId===r.userId),c={userId:r.userId??(d>=0?p[d].userId:""),userEmail:m,userDisplayName:r.userDisplayName??null,role:a};return d>=0?p[d]={...p[d],...c}:(!c.userId&&r.userId&&(c.userId=r.userId),p.push(c)),await (0,u.FV)(t.orgId,{members:p,updatedAt:new Date().toISOString(),updatedBy:t.userId}),n.NextResponse.json({members:p})}catch(r){let e=(0,a.s)(r);if(e)return e;throw r}}[o,u]=p.then?(await p)():p,s()}catch(e){s(e)}})}};var r=require("../../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[9276,5972,4035],()=>t(43910));module.exports=s})();