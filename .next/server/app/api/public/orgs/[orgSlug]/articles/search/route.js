"use strict";(()=>{var t={};t.id=9816,t.ids=[9816],t.modules={20399:t=>{t.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:t=>{t.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3263:t=>{t.exports=import("firebase-admin/app")},79637:t=>{t.exports=import("firebase-admin/auth")},72929:t=>{t.exports=import("firebase-admin/firestore")},10103:(t,e,r)=>{r.a(t,async(t,a)=>{try{r.r(e),r.d(e,{originalPathname:()=>f,patchFetch:()=>o,requestAsyncStorage:()=>d,routeModule:()=>c,serverHooks:()=>g,staticGenerationAsyncStorage:()=>p});var n=r(49303),i=r(88716),u=r(60670),l=r(74331),s=t([l]);l=(s.then?(await s)():s)[0];let c=new n.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/public/orgs/[orgSlug]/articles/search/route",pathname:"/api/public/orgs/[orgSlug]/articles/search",filename:"route",bundlePath:"app/api/public/orgs/[orgSlug]/articles/search/route"},resolvedPagePath:"C:\\Projets - Developpement\\cursor-webit-cop\\app\\api\\public\\orgs\\[orgSlug]\\articles\\search\\route.ts",nextConfigOutput:"",userland:l}),{requestAsyncStorage:d,staticGenerationAsyncStorage:p,serverHooks:g}=c,f="/api/public/orgs/[orgSlug]/articles/search/route";function o(){return(0,u.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:p})}a()}catch(t){a(t)}})},74331:(t,e,r)=>{r.a(t,async(t,a)=>{try{r.r(e),r.d(e,{GET:()=>d});var n=r(87070),i=r(92168),u=r(83895),l=r(7331),s=r(5424),o=r(32630),c=t([u,l,s]);async function d(t,{params:e}){let r=await (0,l.jo)(e.orgSlug);if(!r)return n.NextResponse.json({error:"Organisation non trouv\xe9e"},{status:404});let{searchParams:a}=new URL(t.url),c=a.get("q")?.trim()??"";if(!c)return n.NextResponse.json({error:"Param\xe8tre q (recherche) obligatoire"},{status:400});if(c.length<2)return n.NextResponse.json({error:`La recherche doit contenir au moins 2 caract\xe8res`},{status:400});let d=20,p=a.get("limit");if(null!=p){let t=parseInt(p,10);if(Number.isNaN(t)||t<1||t>50)return n.NextResponse.json({error:"Param\xe8tre limit invalide (1â€“50)"},{status:400});d=t}let g=null,f=a.get("category");if(f){let t=await (0,u.ax)(r.id,f)??await (0,u.fj)(r.id,f);t&&(g=t.id)}let m=null,h=a.get("tag");if(h){let t=await (0,s.MT)(r.id,h)??await (0,s.iP)(r.id,h);t&&(m=t.id)}let A=a.get("author")??null,y=a.get("locale")?.trim(),b=r.supportedLocales??[];if(y&&b.length>0&&!b.includes(y))return n.NextResponse.json({error:"Locale non support\xe9e par cette organisation"},{status:400});let I=(0,o.jR)(r,y),w=await (0,i.DN)(r.id,c,{categoryId:g??void 0,tagId:m??void 0,authorId:A??void 0,locale:I,limit:d});return n.NextResponse.json({items:w.items.map(t=>t.article),query:w.query,limit:w.limit})}[u,l,s]=c.then?(await c)():c,a()}catch(t){a(t)}})},52099:(t,e,r)=>{r.a(t,async(t,a)=>{try{r.d(e,{C:()=>d,i:()=>p});var n=r(3263),i=r(79637),u=r(72929),l=t([n,i,u]);[n,i,u]=l.then?(await l)():l;let s=(0,n.getApps)(),o=!!process.env.FIREBASE_PROJECT_ID&&!!process.env.FIREBASE_CLIENT_EMAIL&&!!process.env.FIREBASE_PRIVATE_KEY;o||console.warn("Firebase Admin initialis\xe9 en mode limit\xe9 : variables FIREBASE_* manquantes dans l'environnement.");let c=s[0]??(o?(0,n.initializeApp)({credential:(0,n.cert)({projectId:process.env.FIREBASE_PROJECT_ID,clientEmail:process.env.FIREBASE_CLIENT_EMAIL,privateKey:process.env.FIREBASE_PRIVATE_KEY.replace(/\\n/g,"\n")}),databaseURL:process.env.FIREBASE_DATABASE_URL}):(0,n.initializeApp)()),d=o?(0,i.getAuth)(c):null,p=o?(0,u.getFirestore)(c):null;a()}catch(t){a(t)}})},97681:(t,e,r)=>{r.a(t,async(t,a)=>{try{r.d(e,{db:()=>u});var n=r(52099),i=t([n]);let u=(n=(i.then?(await i)():i)[0]).i;a()}catch(t){a(t)}})},3485:(t,e,r)=>{async function a(...t){return[]}async function n(...t){return{items:[],nextCursor:null}}async function i(...t){return{items:[],nextCursor:null}}async function u(...t){return null}async function l(...t){return{}}async function s(...t){}r.d(e,{G$:()=>n,KR:()=>a,fq:()=>u,j8:()=>s,tu:()=>l,vL:()=>i})},83895:(t,e,r)=>{r.a(t,async(t,a)=>{try{r.d(e,{ax:()=>c,fj:()=>d,k4:()=>p,kb:()=>o});var n=r(97681),i=r(48680),u=t([n,i]);function l(t){return n.db.collection("organizations").doc(t).collection("categories")}function s(t,e){let r={...e,id:t};return{...r,createdAt:(0,i.b)(r.createdAt),updatedAt:(0,i.b)(r.updatedAt)}}async function o(t){return(await l(t).get()).docs.map(t=>s(t.id,t.data()))}async function c(t,e){let r=await l(t).doc(e).get();return r.exists?s(r.id,r.data()):null}async function d(t,e){return(await o(t)).find(t=>t.slug===e)??null}async function p(t,e){let r=new Date().toISOString(),a=l(t).doc(),n={id:a.id,orgId:t,name:e.name,slug:e.slug,createdAt:r,updatedAt:r};return await a.set({...n,createdAt:(0,i.B)(r),updatedAt:(0,i.B)(r)}),n}[n,i]=u.then?(await u)():u,a()}catch(t){a(t)}})},48680:(t,e,r)=>{r.a(t,async(t,a)=>{try{r.d(e,{B:()=>l,b:()=>u});var n=r(72929),i=t([n]);function u(t){return t?"string"==typeof t?t:t.toDate().toISOString():new Date(0).toISOString()}function l(t){return n.Timestamp.fromDate(new Date(t))}n=(i.then?(await i)():i)[0],a()}catch(t){a(t)}})},7331:(t,e,r)=>{r.a(t,async(t,a)=>{try{r.d(e,{FV:()=>c,Xu:()=>o,jo:()=>s});var n=r(97681),i=r(48680),u=t([n,i]);function l(t,e){let r=t.defaultLocale??"fr-CA",a=t.supportedLocales??[r],n=t.members??[];return{...t,id:e,orgId:e,defaultLocale:r,supportedLocales:a,members:n,createdAt:(0,i.b)(t.createdAt),updatedAt:(0,i.b)(t.updatedAt)}}async function s(t){let e=await n.db.collection("organizations").where("slug","==",t).limit(1).get();if(e.empty)return null;let r=e.docs[0],a=r.data();return l(a,r.id)}async function o(t){let e=await n.db.collection("organizations").doc(t).get();if(!e.exists)return null;let r=e.data();return l(r,e.id)}async function c(t,e){let r=n.db.collection("organizations").doc(t),a={...e};void 0!==e.updatedAt&&(a.updatedAt=e.updatedAt),void 0!==e.updatedBy&&(a.updatedBy=e.updatedBy),void 0!==e.members&&(a.members=e.members),await r.update(a)}[n,i]=u.then?(await u)():u,a()}catch(t){a(t)}})},5424:(t,e,r)=>{r.a(t,async(t,a)=>{try{r.d(e,{MT:()=>c,Z1:()=>p,iP:()=>d,ln:()=>g,rw:()=>o});var n=r(97681),i=r(48680),u=t([n,i]);function l(t){return n.db.collection("organizations").doc(t).collection("tags")}function s(t,e){let r={...e,id:t};return{...r,createdAt:(0,i.b)(r.createdAt),updatedAt:(0,i.b)(r.updatedAt)}}async function o(t){return(await l(t).get()).docs.map(t=>s(t.id,t.data()))}async function c(t,e){let r=await l(t).doc(e).get();return r.exists?s(r.id,r.data()):null}async function d(t,e){return(await o(t)).find(t=>t.slug===e)??null}async function p(t,e){if(0===e.length)return[];let r=[...new Set(e)],a=[];for(let e of r){let r=await c(t,e);r&&a.push(r)}return a}async function g(t,e){let r=new Date().toISOString(),a=l(t).doc(),n={id:a.id,orgId:t,name:e.name,slug:e.slug,createdAt:r,updatedAt:r};return await a.set({...n,createdAt:(0,i.B)(r),updatedAt:(0,i.B)(r)}),n}[n,i]=u.then?(await u)():u,a()}catch(t){a(t)}})},92168:(t,e,r)=>{r.d(e,{DN:()=>s,u:()=>u});var a=r(3485);let n=new Set("le la les un une des du de ce cette ces mon ma mes ton ta tes son sa ses notre votre leur je tu il elle on nous vous ils elles et ou mais que qui dont o\xf9 avec sans sous sur pour dans par ici l\xe0 alors donc or ni".split(" "));function i(t){return(t??"").toLowerCase().trim().normalize("NFD").replace(/\p{Diacritic}/gu,"").replace(/\s+/g," ").split(" ").filter(t=>t.length>1&&!n.has(t)).join(" ")}function u(t){if(!t?.length)return"";let e=[];for(let r of t)switch(r.type){case"hero":e.push(r.title??""),e.push(r.subtitle??"");break;case"richText":e.push((r.html??"").replace(/<[^>]+>/g," ").replace(/\s+/g," ").trim());break;case"faq":for(let t of r.items??[])e.push(t.question??"",t.answer??"");break;case"cta":e.push(r.label??"")}return e.filter(Boolean).join(" ")}async function l(t,e){let r=await (0,a.G$)({orgId:t,status:"published",limit:500,orderBy:"publishedAt",direction:"desc"}),n=[];for(let t of r.items){let e=t.current?.title??"",r=t.current?.excerpt??"",a=u(t.current?.blocks),l=i([e,r,a].filter(Boolean).join(" "));n.push({id:t.id,slug:t.current?.slug??"",title:e,excerpt:r,contentText:a,searchText:l,publishedAt:t.current?.publishedAt??t.updatedAt??t.createdAt??"",categoryId:t.categoryId??null,tagIds:t.tagIds??[],authorId:t.authorId??null,article:t})}return n}async function s(t,e,r={}){let a=(e??"").trim();if(a.length<2)return{items:[],query:a,limit:r.limit??20};let n=i(a).split(" ").filter(Boolean);if(0===n.length)return{items:[],query:a,limit:r.limit??20};let u=await l(t,r.locale);null!=r.categoryId&&""!==r.categoryId&&(u=u.filter(t=>t.categoryId===r.categoryId)),null!=r.tagId&&""!==r.tagId&&(u=u.filter(t=>t.tagIds.includes(r.tagId))),null!=r.authorId&&""!==r.authorId&&(u=u.filter(t=>t.authorId===r.authorId));let s=Math.min(r.limit??20,50);return{items:u.map(t=>({article:t.article,score:function(t,e){let r=t.searchText,a=i(t.title),n=i(t.excerpt),u=0;for(let t of e){if(t&&!(t.length<2))u+=5*(a.includes(t)?1:0)+2*(n.includes(t)?1:0)+(r.includes(t)?1:0)}return u}(t,n)})).filter(t=>t.score>0).sort((t,e)=>e.score!==t.score?e.score-t.score:(e.article.current?.publishedAt??e.article.updatedAt??"").localeCompare(t.article.current?.publishedAt??t.article.updatedAt??"")).slice(0,s),query:a,limit:s}}},32630:(t,e,r)=>{function a(t,e=new Date){if("published"!==t.status)return!1;let r=e.toISOString();return(null==t.publishAt||""===t.publishAt||!(t.publishAt>r))&&(null==t.unpublishAt||""===t.unpublishAt||!(t.unpublishAt<=r))}function n(t,e){let r=t=>{if(null==t||""===t)return null;let e=new Date(t);return Number.isNaN(e.getTime())?null:e},a=r(t),n=r(e);return null!=t&&""!==t&&null===a?{error:"Format de date invalide pour publishAt (attendu ISO date-time)"}:null!=e&&""!==e&&null===n?{error:"Format de date invalide pour unpublishAt (attendu ISO date-time)"}:null!=a&&null!=n&&a>n?{error:"publishAt ne peut pas \xeatre post\xe9rieur \xe0 unpublishAt"}:{}}function i(t,e){let r=t.supportedLocales??[],a=t.defaultLocale??"fr-CA";return e&&""!==e.trim()&&r.includes(e)?e:a}r.d(e,{C2:()=>a,RZ:()=>n,jR:()=>i})}};var e=require("../../../../../../../webpack-runtime.js");e.C(t);var r=t=>e(e.s=t),a=e.X(0,[9276,5972],()=>r(10103));module.exports=a})();