"use strict";(()=>{var t={};t.id=3228,t.ids=[3228],t.modules={20399:t=>{t.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:t=>{t.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3263:t=>{t.exports=import("firebase-admin/app")},79637:t=>{t.exports=import("firebase-admin/auth")},72929:t=>{t.exports=import("firebase-admin/firestore")},56797:(t,e,a)=>{a.a(t,async(t,n)=>{try{a.r(e),a.d(e,{originalPathname:()=>A,patchFetch:()=>s,requestAsyncStorage:()=>c,routeModule:()=>d,serverHooks:()=>g,staticGenerationAsyncStorage:()=>p});var r=a(49303),i=a(88716),u=a(60670),o=a(98170),l=t([o]);o=(l.then?(await l)():l)[0];let d=new r.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/public/orgs/[orgSlug]/pages/[slug]/route",pathname:"/api/public/orgs/[orgSlug]/pages/[slug]",filename:"route",bundlePath:"app/api/public/orgs/[orgSlug]/pages/[slug]/route"},resolvedPagePath:"C:\\Projets - Developpement\\cursor-webit-cop\\app\\api\\public\\orgs\\[orgSlug]\\pages\\[slug]\\route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:c,staticGenerationAsyncStorage:p,serverHooks:g}=d,A="/api/public/orgs/[orgSlug]/pages/[slug]/route";function s(){return(0,u.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:p})}n()}catch(t){n(t)}})},98170:(t,e,a)=>{a.a(t,async(t,n)=>{try{a.r(e),a.d(e,{GET:()=>s});var r=a(87070),i=a(7331),u=a(45487),o=a(32630),l=t([i,u]);async function s(t,{params:e}){let a=await (0,i.jo)(e.orgSlug);if(!a)return r.NextResponse.json({error:"Organisation non trouv\xe9e"},{status:404});let n=new URL(t.url).searchParams.get("locale")?.trim(),l=a.supportedLocales??[];if(n&&l.length>0&&!l.includes(n))return r.NextResponse.json({error:"Locale non support\xe9e par cette organisation"},{status:400});let s=(0,o.jR)(a,n),d=await (0,u.sb)(a.id,e.slug,{locale:s,defaultLocale:a.defaultLocale});return d?r.NextResponse.json(d):r.NextResponse.json({error:"Page non trouv\xe9e"},{status:404})}[i,u]=l.then?(await l)():l,n()}catch(t){n(t)}})},52099:(t,e,a)=>{a.a(t,async(t,n)=>{try{a.d(e,{C:()=>c,i:()=>p});var r=a(3263),i=a(79637),u=a(72929),o=t([r,i,u]);[r,i,u]=o.then?(await o)():o;let l=(0,r.getApps)(),s=!!process.env.FIREBASE_PROJECT_ID&&!!process.env.FIREBASE_CLIENT_EMAIL&&!!process.env.FIREBASE_PRIVATE_KEY;s||console.warn("Firebase Admin initialis\xe9 en mode limit\xe9 : variables FIREBASE_* manquantes dans l'environnement.");let d=l[0]??(s?(0,r.initializeApp)({credential:(0,r.cert)({projectId:process.env.FIREBASE_PROJECT_ID,clientEmail:process.env.FIREBASE_CLIENT_EMAIL,privateKey:process.env.FIREBASE_PRIVATE_KEY.replace(/\\n/g,"\n")}),databaseURL:process.env.FIREBASE_DATABASE_URL}):(0,r.initializeApp)()),c=s?(0,i.getAuth)(d):null,p=s?(0,u.getFirestore)(d):null;n()}catch(t){n(t)}})},97681:(t,e,a)=>{a.a(t,async(t,n)=>{try{a.d(e,{db:()=>u});var r=a(52099),i=t([r]);let u=(r=(i.then?(await i)():i)[0]).i;n()}catch(t){n(t)}})},48680:(t,e,a)=>{a.a(t,async(t,n)=>{try{a.d(e,{B:()=>o,b:()=>u});var r=a(72929),i=t([r]);function u(t){return t?"string"==typeof t?t:t.toDate().toISOString():new Date(0).toISOString()}function o(t){return r.Timestamp.fromDate(new Date(t))}r=(i.then?(await i)():i)[0],n()}catch(t){n(t)}})},7331:(t,e,a)=>{a.a(t,async(t,n)=>{try{a.d(e,{FV:()=>d,Xu:()=>s,jo:()=>l});var r=a(97681),i=a(48680),u=t([r,i]);function o(t,e){let a=t.defaultLocale??"fr-CA",n=t.supportedLocales??[a],r=t.members??[];return{...t,id:e,orgId:e,defaultLocale:a,supportedLocales:n,members:r,createdAt:(0,i.b)(t.createdAt),updatedAt:(0,i.b)(t.updatedAt)}}async function l(t){let e=await r.db.collection("organizations").where("slug","==",t).limit(1).get();if(e.empty)return null;let a=e.docs[0],n=a.data();return o(n,a.id)}async function s(t){let e=await r.db.collection("organizations").doc(t).get();if(!e.exists)return null;let a=e.data();return o(a,e.id)}async function d(t,e){let a=r.db.collection("organizations").doc(t),n={...e};void 0!==e.updatedAt&&(n.updatedAt=e.updatedAt),void 0!==e.updatedBy&&(n.updatedBy=e.updatedBy),void 0!==e.members&&(n.members=e.members),await a.update(n)}[r,i]=u.then?(await u)():u,n()}catch(t){n(t)}})},45487:(t,e,a)=>{a.a(t,async(t,n)=>{try{a.d(e,{D4:()=>A,Jq:()=>g,fx:()=>d,sb:()=>p,u5:()=>c});var r=a(97681),i=a(48680),u=a(32630),o=t([r,i]);function l(t){return r.db.collection("organizations").doc(t).collection("pages")}function s(t,e){let a={...e,id:t},n=a.locale??"fr-CA",r=a.translationGroupId??null,u=a.translations??[],o=a.publishAt??null,l=a.unpublishAt??null,s=a.editorialStatus??null,d=a.assignment??null;return{...a,locale:n,translationGroupId:r,translations:u,publishAt:o,unpublishAt:l,editorialStatus:s,assignment:d,createdAt:(0,i.b)(a.createdAt),updatedAt:(0,i.b)(a.updatedAt)}}async function d(t,e){let a=await l(t).doc(e).get();return a.exists?s(a.id,a.data()):null}async function c(t){return(await l(t).get()).docs.map(t=>s(t.id,t.data()))}async function p(t,e,a){let n=await c(t),r=a?.locale??a?.defaultLocale??"fr-CA";return n.find(t=>t.current.slug===e&&t.locale===r&&(0,u.C2)(t))||null}async function g(t){let e=l(t.orgId).doc(t.id),a={...t,createdAt:(0,i.B)(t.createdAt),updatedAt:(0,i.B)(t.updatedAt)};await e.set(a,{merge:!0})}async function A(t){let e=new Date().toISOString(),a={id:l(t.orgId).doc().id,orgId:t.orgId,type:"page",status:t.status,createdAt:e,updatedAt:e,createdBy:t.createdBy,updatedBy:t.createdBy,version:1,current:t.payload,history:t.history,locale:t.locale??"fr-CA",translationGroupId:t.translationGroupId??null,translations:t.translations??[],publishAt:null,unpublishAt:null,editorialStatus:null,assignment:null};return await g(a),a}[r,i]=o.then?(await o)():o,n()}catch(t){n(t)}})},32630:(t,e,a)=>{function n(t,e=new Date){if("published"!==t.status)return!1;let a=e.toISOString();return(null==t.publishAt||""===t.publishAt||!(t.publishAt>a))&&(null==t.unpublishAt||""===t.unpublishAt||!(t.unpublishAt<=a))}function r(t,e){let a=t=>{if(null==t||""===t)return null;let e=new Date(t);return Number.isNaN(e.getTime())?null:e},n=a(t),r=a(e);return null!=t&&""!==t&&null===n?{error:"Format de date invalide pour publishAt (attendu ISO date-time)"}:null!=e&&""!==e&&null===r?{error:"Format de date invalide pour unpublishAt (attendu ISO date-time)"}:null!=n&&null!=r&&n>r?{error:"publishAt ne peut pas \xeatre post\xe9rieur \xe0 unpublishAt"}:{}}function i(t,e){let a=t.supportedLocales??[],n=t.defaultLocale??"fr-CA";return e&&""!==e.trim()&&a.includes(e)?e:n}a.d(e,{C2:()=>n,RZ:()=>r,jR:()=>i})}};var e=require("../../../../../../../webpack-runtime.js");e.C(t);var a=t=>e(e.s=t),n=e.X(0,[9276,5972],()=>a(56797));module.exports=n})();