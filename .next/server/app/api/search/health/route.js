"use strict";(()=>{var e={};e.id=7353,e.ids=[7353],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},84770:e=>{e.exports=require("crypto")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},68621:e=>{e.exports=require("punycode")},76162:e=>{e.exports=require("stream")},17360:e=>{e.exports=require("url")},71568:e=>{e.exports=require("zlib")},16810:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>x,patchFetch:()=>I,requestAsyncStorage:()=>g,routeModule:()=>c,serverHooks:()=>p,staticGenerationAsyncStorage:()=>h});var i={};r.r(i),r.d(i,{GET:()=>d});var a=r(49303),n=r(88716),s=r(60670),o=r(87070),l=r(85650),u=r(19238);async function d(){let e=(0,l.R)();if(!e)return o.NextResponse.json({provider:"local",status:"ok",details:"Aucun provider externe configur\xe9"});try{let t=new u.rm(e),r=await t.health(),i="ok"===r.status?"ok":"degraded"===r.status?"degraded":"error";return o.NextResponse.json({provider:"meilisearch",status:i,...r.message&&{details:r.message}})}catch(t){let e=t instanceof Error?t.message:String(t);return o.NextResponse.json({provider:"meilisearch",status:"error",details:e})}}let c=new a.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/search/health/route",pathname:"/api/search/health",filename:"route",bundlePath:"app/api/search/health/route"},resolvedPagePath:"C:\\Projets - Developpement\\cursor-webit-cop\\app\\api\\search\\health\\route.ts",nextConfigOutput:"",userland:i}),{requestAsyncStorage:g,staticGenerationAsyncStorage:h,serverHooks:p}=c,x="/api/search/health/route";function I(){return(0,s.patchFetch)({serverHooks:p,staticGenerationAsyncStorage:h})}},85650:(e,t,r)=>{r.d(t,{R:()=>i});function i(){let e=process.env.MEILISEARCH_HOST?.trim(),t=process.env.MEILISEARCH_API_KEY?.trim();return e&&t?{host:e,apiKey:t,indexPrefix:process.env.MEILISEARCH_INDEX_PREFIX?.trim()??""}:null}},19238:(e,t,r)=>{r.d(t,{rm:()=>o});var i=r(95392);function a(e){return{id:`${e.orgId}:${e.id}`,orgId:e.orgId,type:e.type,locale:e.locale,title:e.title,slug:e.slug,excerpt:e.excerpt??"",contentText:e.contentText??"",publishedAt:e.publishedAt??null,url:e.url,categoryId:e.categoryId??null,tagIds:e.tagIds??[],authorId:e.authorId??null}}function n(e){let t=String(e.id??""),r={id:t.includes(":")?t.split(":").slice(1).join(":"):t,orgId:String(e.orgId??""),type:e.type??"article",locale:String(e.locale??""),title:String(e.title??""),slug:String(e.slug??""),excerpt:null!=e.excerpt?String(e.excerpt):void 0,contentText:null!=e.contentText?String(e.contentText):void 0,publishedAt:null!=e.publishedAt?String(e.publishedAt):null,url:String(e.url??""),categoryId:null!=e.categoryId?String(e.categoryId):null,tagIds:Array.isArray(e.tagIds)?e.tagIds:[],authorId:null!=e.authorId?String(e.authorId):null},i=e._formatted??{},a={title:null!=i.title?String(i.title):void 0,excerpt:null!=i.excerpt?String(i.excerpt):void 0,contentText:null!=i.contentText?String(i.contentText):void 0};return{doc:r,score:"number"==typeof e._rankingScore?e._rankingScore:0,highlights:Object.values(a).some(Boolean)?a:void 0}}r(85650);let s={searchableAttributes:["title","excerpt","contentText"],filterableAttributes:["orgId","type","locale","categoryId","tagIds","authorId"],sortableAttributes:["publishedAt"]};class o{constructor(e){this.client=new i.An({host:e.host,apiKey:e.apiKey}),this.indexPrefix=e.indexPrefix??""}getIndexNameForOrg(e){let t=e.replace(/[^a-zA-Z0-9_-]/g,"_");return`${this.indexPrefix}org_${t}_content`}async ensureIndexForOrg(e){let t=this.getIndexNameForOrg(e),r=this.client.index(t);try{"function"==typeof r.fetchIndexInfo?await r.fetchIndexInfo():"function"==typeof r.getStats&&await r.getStats()}catch{await this.client.createIndex(t,{primaryKey:"id"})}let i=this.client.index(t);await i.updateSettings(s)}async indexDocuments(e){if(0===e.length)return;let t=e[0].orgId;await this.ensureIndexForOrg(t);let r=this.getIndexNameForOrg(t),i=this.client.index(r),n=e.map(a);await i.addDocuments(n)}async deleteDocuments(e){if(0===e.length)return;let t=new Map;for(let{id:r,orgId:i}of e){let e=t.get(i)??[];e.push(`${i}:${r}`),t.set(i,e)}for(let[e,r]of t){let t=this.getIndexNameForOrg(e),i=this.client.index(t);await i.deleteDocuments(r)}}async clearOrg(e){try{let t=this.getIndexNameForOrg(e),r=this.client.index(t);await r.deleteAllDocuments()}catch{}}async search(e){let t=(e.q??"").trim();if(t.length<2)return{items:[],total:0};await this.ensureIndexForOrg(e.orgId);let r=this.getIndexNameForOrg(e.orgId),i=this.client.index(r),a=[`orgId = "${e.orgId}"`];e.locale&&a.push(`locale = "${e.locale}"`),e.type&&a.push(`type = "${e.type}"`),null!=e.categoryId&&""!==e.categoryId&&a.push(`categoryId = "${e.categoryId}"`),null!=e.tagId&&""!==e.tagId&&a.push(`tagIds = "${e.tagId}"`),null!=e.authorId&&""!==e.authorId&&a.push(`authorId = "${e.authorId}"`);let s={limit:Math.min(e.limit??20,50),offset:Math.max(0,e.offset??0),filter:a.length>0?a:void 0,attributesToHighlight:["title","excerpt","contentText"],highlightPreTag:"<mark>",highlightPostTag:"</mark>"};s.sort=["publishedAt:desc"];let o=await i.search(t,s),l=o.hits??[],u=o.estimatedTotalHits??l.length;return{items:l.map(n),total:u}}async health(){try{let e=await this.client.health();if("available"===e.status)return{status:"ok"};return{status:"degraded",message:String(e.status)}}catch(e){return{status:"error",message:e instanceof Error?e.message:String(e)}}}}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),i=t.X(0,[9276,5972,820,5392],()=>r(16810));module.exports=i})();