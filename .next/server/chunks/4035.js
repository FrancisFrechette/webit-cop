"use strict";exports.id=4035,exports.ids=[4035],exports.modules={90455:(e,t,r)=>{r.a(e,async(e,n)=>{try{r.d(t,{$9:()=>i,Ql:()=>l,mk:()=>s});var a=r(39097),o=e([a]);let s=(a=(o.then?(await o)():o)[0]).mk,i=a.$9,l=a.Ql;n()}catch(e){n(e)}})},76899:(e,t,r)=>{r.d(t,{s:()=>a});var n=r(87070);function a(e){let t=e instanceof Error?e.message:String(e);return t.includes("non authentifi\xe9")||t.includes("Custom Claims")?n.NextResponse.json({error:t},{status:401}):t.includes("Forbidden")||t.includes("membre")||t.includes("Organisation non trouv\xe9e")?n.NextResponse.json({error:t},{status:403}):null}},25371:(e,t,r)=>{r.d(t,{Fs:()=>s,fi:()=>o});let n=["org.manage_members","content.create_page","content.edit_page","content.publish_page","content.rollback_page","content.create_article","content.edit_article","content.publish_article","content.rollback_article","content.comment","content.manage_editorial_status","content.manage_translations","content.reindex_search","content.view_calendar","content.view_all"],a={owner:[...n],admin:[...n],editor:["content.create_page","content.edit_page","content.publish_page","content.rollback_page","content.create_article","content.edit_article","content.publish_article","content.rollback_article","content.comment","content.manage_editorial_status","content.manage_translations","content.view_calendar","content.view_all"],author:["content.create_page","content.edit_page","content.create_article","content.edit_article","content.comment","content.view_calendar","content.view_all"],viewer:["content.comment","content.view_calendar","content.view_all"]};function o(e){return a[e]??[]}function s(e,t){return e.includes(t)}},39097:(e,t,r)=>{r.a(e,async(e,n)=>{try{r.d(t,{$9:()=>u,Ql:()=>f,mk:()=>d});var a=r(71615),o=r(52099),s=r(7331),i=r(25371),l=e([o,s]);async function c(){let e=(0,a.cookies)(),t=(0,a.headers)(),r=t.get("authorization")??t.get("Authorization"),n=r?.startsWith("Bearer ")?r.slice(7):void 0,s=e.get("session")?.value??e.get("__session")?.value,i=n??s;if(!i)throw Error("Utilisateur non authentifi\xe9.");let l=await o.C.verifyIdToken(i),c=l.name??l.email??null;return{uid:l.uid,orgId:l.orgId,role:l.role,email:l.email,displayName:c}}async function d(){let{uid:e,orgId:t,role:r,displayName:n}=await c();if(!t||!r)throw Error("Custom Claims Firebase manquants (orgId / role) sur le token.");return{uid:e,orgId:t,role:r,displayName:n}}async function u(e){let t;let{uid:r,orgId:n,email:a,displayName:o}=await c();if(!n)throw Error("Custom Claims Firebase : orgId manquant sur le token.");let l=await (0,s.Xu)(n);if(!l)throw Error("Organisation non trouv\xe9e.");let d=l.members??[],u=d.find(e=>e.userId===r||a&&e.userEmail.toLowerCase()===a.toLowerCase());if(u)t=u.role;else if(0===d.length)t="owner";else throw Error("Forbidden: vous n'\xeates pas membre de cette organisation.");let f=(0,i.fi)(t);return{userId:r,userEmail:a??null,userDisplayName:o??null,orgId:n,orgRole:t,permissions:f}}function f(e,t){if(!(0,i.Fs)(e.permissions,t))throw Error(`Forbidden: missing permission ${t}`)}[o,s]=l.then?(await l)():l,n()}catch(e){n(e)}})},52099:(e,t,r)=>{r.a(e,async(e,n)=>{try{r.d(t,{C:()=>u,i:()=>f});var a=r(3263),o=r(79637),s=r(72929),i=e([a,o,s]);[a,o,s]=i.then?(await i)():i;let l=(0,a.getApps)(),c=!!process.env.FIREBASE_PROJECT_ID&&!!process.env.FIREBASE_CLIENT_EMAIL&&!!process.env.FIREBASE_PRIVATE_KEY;c||console.warn("Firebase Admin initialis\xe9 en mode limit\xe9 : variables FIREBASE_* manquantes dans l'environnement.");let d=l[0]??(c?(0,a.initializeApp)({credential:(0,a.cert)({projectId:process.env.FIREBASE_PROJECT_ID,clientEmail:process.env.FIREBASE_CLIENT_EMAIL,privateKey:process.env.FIREBASE_PRIVATE_KEY.replace(/\\n/g,"\n")}),databaseURL:process.env.FIREBASE_DATABASE_URL}):(0,a.initializeApp)()),u=c?(0,o.getAuth)(d):null,f=c?(0,s.getFirestore)(d):null;n()}catch(e){n(e)}})},97681:(e,t,r)=>{r.a(e,async(e,n)=>{try{r.d(t,{db:()=>s});var a=r(52099),o=e([a]);let s=(a=(o.then?(await o)():o)[0]).i;n()}catch(e){n(e)}})},48680:(e,t,r)=>{r.a(e,async(e,n)=>{try{r.d(t,{B:()=>i,b:()=>s});var a=r(72929),o=e([a]);function s(e){return e?"string"==typeof e?e:e.toDate().toISOString():new Date(0).toISOString()}function i(e){return a.Timestamp.fromDate(new Date(e))}a=(o.then?(await o)():o)[0],n()}catch(e){n(e)}})},7331:(e,t,r)=>{r.a(e,async(e,n)=>{try{r.d(t,{FV:()=>d,Xu:()=>c,jo:()=>l});var a=r(97681),o=r(48680),s=e([a,o]);function i(e,t){let r=e.defaultLocale??"fr-CA",n=e.supportedLocales??[r],a=e.members??[];return{...e,id:t,orgId:t,defaultLocale:r,supportedLocales:n,members:a,createdAt:(0,o.b)(e.createdAt),updatedAt:(0,o.b)(e.updatedAt)}}async function l(e){let t=await a.db.collection("organizations").where("slug","==",e).limit(1).get();if(t.empty)return null;let r=t.docs[0],n=r.data();return i(n,r.id)}async function c(e){let t=await a.db.collection("organizations").doc(e).get();if(!t.exists)return null;let r=t.data();return i(r,t.id)}async function d(e,t){let r=a.db.collection("organizations").doc(e),n={...t};void 0!==t.updatedAt&&(n.updatedAt=t.updatedAt),void 0!==t.updatedBy&&(n.updatedBy=t.updatedBy),void 0!==t.members&&(n.members=t.members),await r.update(n)}[a,o]=s.then?(await s)():s,n()}catch(e){n(e)}})},71615:(e,t,r)=>{var n=r(88757);r.o(n,"cookies")&&r.d(t,{cookies:function(){return n.cookies}}),r.o(n,"headers")&&r.d(t,{headers:function(){return n.headers}})},33085:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"DraftMode",{enumerable:!0,get:function(){return o}});let n=r(45869),a=r(6278);class o{get isEnabled(){return this._provider.isEnabled}enable(){let e=n.staticGenerationAsyncStorage.getStore();return e&&(0,a.trackDynamicDataAccessed)(e,"draftMode().enable()"),this._provider.enable()}disable(){let e=n.staticGenerationAsyncStorage.getStore();return e&&(0,a.trackDynamicDataAccessed)(e,"draftMode().disable()"),this._provider.disable()}constructor(e){this._provider=e}}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},88757:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{cookies:function(){return f},draftMode:function(){return p},headers:function(){return u}});let n=r(68996),a=r(53047),o=r(92044),s=r(72934),i=r(33085),l=r(6278),c=r(45869),d=r(54580);function u(){let e="headers",t=c.staticGenerationAsyncStorage.getStore();if(t){if(t.forceStatic)return a.HeadersAdapter.seal(new Headers({}));(0,l.trackDynamicDataAccessed)(t,e)}return(0,d.getExpectedRequestStore)(e).headers}function f(){let e="cookies",t=c.staticGenerationAsyncStorage.getStore();if(t){if(t.forceStatic)return n.RequestCookiesAdapter.seal(new o.RequestCookies(new Headers({})));(0,l.trackDynamicDataAccessed)(t,e)}let r=(0,d.getExpectedRequestStore)(e),a=s.actionAsyncStorage.getStore();return(null==a?void 0:a.isAction)||(null==a?void 0:a.isAppRoute)?r.mutableCookies:r.cookies}function p(){let e=(0,d.getExpectedRequestStore)("draftMode");return new i.DraftMode(e.draftMode)}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},53047:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{HeadersAdapter:function(){return o},ReadonlyHeadersError:function(){return a}});let n=r(38238);class a extends Error{constructor(){super("Headers cannot be modified. Read more: https://nextjs.org/docs/app/api-reference/functions/headers")}static callable(){throw new a}}class o extends Headers{constructor(e){super(),this.headers=new Proxy(e,{get(t,r,a){if("symbol"==typeof r)return n.ReflectAdapter.get(t,r,a);let o=r.toLowerCase(),s=Object.keys(e).find(e=>e.toLowerCase()===o);if(void 0!==s)return n.ReflectAdapter.get(t,s,a)},set(t,r,a,o){if("symbol"==typeof r)return n.ReflectAdapter.set(t,r,a,o);let s=r.toLowerCase(),i=Object.keys(e).find(e=>e.toLowerCase()===s);return n.ReflectAdapter.set(t,i??r,a,o)},has(t,r){if("symbol"==typeof r)return n.ReflectAdapter.has(t,r);let a=r.toLowerCase(),o=Object.keys(e).find(e=>e.toLowerCase()===a);return void 0!==o&&n.ReflectAdapter.has(t,o)},deleteProperty(t,r){if("symbol"==typeof r)return n.ReflectAdapter.deleteProperty(t,r);let a=r.toLowerCase(),o=Object.keys(e).find(e=>e.toLowerCase()===a);return void 0===o||n.ReflectAdapter.deleteProperty(t,o)}})}static seal(e){return new Proxy(e,{get(e,t,r){switch(t){case"append":case"delete":case"set":return a.callable;default:return n.ReflectAdapter.get(e,t,r)}}})}merge(e){return Array.isArray(e)?e.join(", "):e}static from(e){return e instanceof Headers?e:new o(e)}append(e,t){let r=this.headers[e];"string"==typeof r?this.headers[e]=[r,t]:Array.isArray(r)?r.push(t):this.headers[e]=t}delete(e){delete this.headers[e]}get(e){let t=this.headers[e];return void 0!==t?this.merge(t):null}has(e){return void 0!==this.headers[e]}set(e,t){this.headers[e]=t}forEach(e,t){for(let[r,n]of this.entries())e.call(t,n,r,this)}*entries(){for(let e of Object.keys(this.headers)){let t=e.toLowerCase(),r=this.get(t);yield[t,r]}}*keys(){for(let e of Object.keys(this.headers)){let t=e.toLowerCase();yield t}}*values(){for(let e of Object.keys(this.headers)){let t=this.get(e);yield t}}[Symbol.iterator](){return this.entries()}}},68996:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{MutableRequestCookiesAdapter:function(){return u},ReadonlyRequestCookiesError:function(){return s},RequestCookiesAdapter:function(){return i},appendMutableCookies:function(){return d},getModifiedCookieValues:function(){return c}});let n=r(92044),a=r(38238),o=r(45869);class s extends Error{constructor(){super("Cookies can only be modified in a Server Action or Route Handler. Read more: https://nextjs.org/docs/app/api-reference/functions/cookies#cookiessetname-value-options")}static callable(){throw new s}}class i{static seal(e){return new Proxy(e,{get(e,t,r){switch(t){case"clear":case"delete":case"set":return s.callable;default:return a.ReflectAdapter.get(e,t,r)}}})}}let l=Symbol.for("next.mutated.cookies");function c(e){let t=e[l];return t&&Array.isArray(t)&&0!==t.length?t:[]}function d(e,t){let r=c(t);if(0===r.length)return!1;let a=new n.ResponseCookies(e),o=a.getAll();for(let e of r)a.set(e);for(let e of o)a.set(e);return!0}class u{static wrap(e,t){let r=new n.ResponseCookies(new Headers);for(let t of e.getAll())r.set(t);let s=[],i=new Set,c=()=>{let e=o.staticGenerationAsyncStorage.getStore();if(e&&(e.pathWasRevalidated=!0),s=r.getAll().filter(e=>i.has(e.name)),t){let e=[];for(let t of s){let r=new n.ResponseCookies(new Headers);r.set(t),e.push(r.toString())}t(e)}};return new Proxy(r,{get(e,t,r){switch(t){case l:return s;case"delete":return function(...t){i.add("string"==typeof t[0]?t[0]:t[0].name);try{e.delete(...t)}finally{c()}};case"set":return function(...t){i.add("string"==typeof t[0]?t[0]:t[0].name);try{return e.set(...t)}finally{c()}};default:return a.ReflectAdapter.get(e,t,r)}}})}}}};