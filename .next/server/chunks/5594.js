"use strict";exports.id=5594,exports.ids=[5594],exports.modules={90455:(e,t,r)=>{r.a(e,async(e,n)=>{try{r.d(t,{$9:()=>s,Ql:()=>l,mk:()=>i});var a=r(39097),o=e([a]);let i=(a=(o.then?(await o)():o)[0]).mk,s=a.$9,l=a.Ql;n()}catch(e){n(e)}})},25371:(e,t,r)=>{r.d(t,{Fs:()=>i,fi:()=>o});let n=["org.manage_members","content.create_page","content.edit_page","content.publish_page","content.rollback_page","content.create_article","content.edit_article","content.publish_article","content.rollback_article","content.comment","content.manage_editorial_status","content.manage_translations","content.reindex_search","content.view_calendar","content.view_all"],a={owner:[...n],admin:[...n],editor:["content.create_page","content.edit_page","content.publish_page","content.rollback_page","content.create_article","content.edit_article","content.publish_article","content.rollback_article","content.comment","content.manage_editorial_status","content.manage_translations","content.view_calendar","content.view_all"],author:["content.create_page","content.edit_page","content.create_article","content.edit_article","content.comment","content.view_calendar","content.view_all"],viewer:["content.comment","content.view_calendar","content.view_all"]};function o(e){return a[e]??[]}function i(e,t){return e.includes(t)}},39097:(e,t,r)=>{r.a(e,async(e,n)=>{try{r.d(t,{$9:()=>d,Ql:()=>f,mk:()=>u});var a=r(71615),o=r(52099),i=r(7331),s=r(25371),l=e([o,i]);async function c(){let e=(0,a.cookies)(),t=(0,a.headers)(),r=t.get("authorization")??t.get("Authorization"),n=r?.startsWith("Bearer ")?r.slice(7):void 0,i=e.get("session")?.value??e.get("__session")?.value,s=n??i;if(!s)throw Error("Utilisateur non authentifi\xe9.");let l=await o.C.verifyIdToken(s),c=l.name??l.email??null;return{uid:l.uid,orgId:l.orgId,role:l.role,email:l.email,displayName:c}}async function u(){let{uid:e,orgId:t,role:r,displayName:n}=await c();if(!t||!r)throw Error("Custom Claims Firebase manquants (orgId / role) sur le token.");return{uid:e,orgId:t,role:r,displayName:n}}async function d(e){let t;let{uid:r,orgId:n,email:a,displayName:o}=await c();if(!n)throw Error("Custom Claims Firebase : orgId manquant sur le token.");let l=await (0,i.Xu)(n);if(!l)throw Error("Organisation non trouv\xe9e.");let u=l.members??[],d=u.find(e=>e.userId===r||a&&e.userEmail.toLowerCase()===a.toLowerCase());if(d)t=d.role;else if(0===u.length)t="owner";else throw Error("Forbidden: vous n'\xeates pas membre de cette organisation.");let f=(0,s.fi)(t);return{userId:r,userEmail:a??null,userDisplayName:o??null,orgId:n,orgRole:t,permissions:f}}function f(e,t){if(!(0,s.Fs)(e.permissions,t))throw Error(`Forbidden: missing permission ${t}`)}[o,i]=l.then?(await l)():l,n()}catch(e){n(e)}})},52099:(e,t,r)=>{r.a(e,async(e,n)=>{try{r.d(t,{C:()=>d,i:()=>f});var a=r(3263),o=r(79637),i=r(72929),s=e([a,o,i]);[a,o,i]=s.then?(await s)():s;let l=(0,a.getApps)(),c=!!process.env.FIREBASE_PROJECT_ID&&!!process.env.FIREBASE_CLIENT_EMAIL&&!!process.env.FIREBASE_PRIVATE_KEY;c||console.warn("Firebase Admin initialis\xe9 en mode limit\xe9 : variables FIREBASE_* manquantes dans l'environnement.");let u=l[0]??(c?(0,a.initializeApp)({credential:(0,a.cert)({projectId:process.env.FIREBASE_PROJECT_ID,clientEmail:process.env.FIREBASE_CLIENT_EMAIL,privateKey:process.env.FIREBASE_PRIVATE_KEY.replace(/\\n/g,"\n")}),databaseURL:process.env.FIREBASE_DATABASE_URL}):(0,a.initializeApp)()),d=c?(0,o.getAuth)(u):null,f=c?(0,i.getFirestore)(u):null;n()}catch(e){n(e)}})},97681:(e,t,r)=>{r.a(e,async(e,n)=>{try{r.d(t,{db:()=>i});var a=r(52099),o=e([a]);let i=(a=(o.then?(await o)():o)[0]).i;n()}catch(e){n(e)}})},3485:(e,t,r)=>{async function n(...e){return[]}async function a(...e){return{items:[],nextCursor:null}}async function o(...e){return{items:[],nextCursor:null}}async function i(...e){return null}async function s(...e){return{}}async function l(...e){}r.d(t,{G$:()=>a,KR:()=>n,fq:()=>i,j8:()=>l,tu:()=>s,vL:()=>o})},83895:(e,t,r)=>{r.a(e,async(e,n)=>{try{r.d(t,{ax:()=>u,fj:()=>d,k4:()=>f,kb:()=>c});var a=r(97681),o=r(48680),i=e([a,o]);function s(e){return a.db.collection("organizations").doc(e).collection("categories")}function l(e,t){let r={...t,id:e};return{...r,createdAt:(0,o.b)(r.createdAt),updatedAt:(0,o.b)(r.updatedAt)}}async function c(e){return(await s(e).get()).docs.map(e=>l(e.id,e.data()))}async function u(e,t){let r=await s(e).doc(t).get();return r.exists?l(r.id,r.data()):null}async function d(e,t){return(await c(e)).find(e=>e.slug===t)??null}async function f(e,t){let r=new Date().toISOString(),n=s(e).doc(),a={id:n.id,orgId:e,name:t.name,slug:t.slug,createdAt:r,updatedAt:r};return await n.set({...a,createdAt:(0,o.B)(r),updatedAt:(0,o.B)(r)}),a}[a,o]=i.then?(await i)():i,n()}catch(e){n(e)}})},48680:(e,t,r)=>{r.a(e,async(e,n)=>{try{r.d(t,{B:()=>s,b:()=>i});var a=r(72929),o=e([a]);function i(e){return e?"string"==typeof e?e:e.toDate().toISOString():new Date(0).toISOString()}function s(e){return a.Timestamp.fromDate(new Date(e))}a=(o.then?(await o)():o)[0],n()}catch(e){n(e)}})},7331:(e,t,r)=>{r.a(e,async(e,n)=>{try{r.d(t,{FV:()=>u,Xu:()=>c,jo:()=>l});var a=r(97681),o=r(48680),i=e([a,o]);function s(e,t){let r=e.defaultLocale??"fr-CA",n=e.supportedLocales??[r],a=e.members??[];return{...e,id:t,orgId:t,defaultLocale:r,supportedLocales:n,members:a,createdAt:(0,o.b)(e.createdAt),updatedAt:(0,o.b)(e.updatedAt)}}async function l(e){let t=await a.db.collection("organizations").where("slug","==",e).limit(1).get();if(t.empty)return null;let r=t.docs[0],n=r.data();return s(n,r.id)}async function c(e){let t=await a.db.collection("organizations").doc(e).get();if(!t.exists)return null;let r=t.data();return s(r,t.id)}async function u(e,t){let r=a.db.collection("organizations").doc(e),n={...t};void 0!==t.updatedAt&&(n.updatedAt=t.updatedAt),void 0!==t.updatedBy&&(n.updatedBy=t.updatedBy),void 0!==t.members&&(n.members=t.members),await r.update(n)}[a,o]=i.then?(await i)():i,n()}catch(e){n(e)}})},45487:(e,t,r)=>{r.a(e,async(e,n)=>{try{r.d(t,{D4:()=>y,Jq:()=>p,fx:()=>u,sb:()=>f,u5:()=>d});var a=r(97681),o=r(48680),i=r(32630),s=e([a,o]);function l(e){return a.db.collection("organizations").doc(e).collection("pages")}function c(e,t){let r={...t,id:e},n=r.locale??"fr-CA",a=r.translationGroupId??null,i=r.translations??[],s=r.publishAt??null,l=r.unpublishAt??null,c=r.editorialStatus??null,u=r.assignment??null;return{...r,locale:n,translationGroupId:a,translations:i,publishAt:s,unpublishAt:l,editorialStatus:c,assignment:u,createdAt:(0,o.b)(r.createdAt),updatedAt:(0,o.b)(r.updatedAt)}}async function u(e,t){let r=await l(e).doc(t).get();return r.exists?c(r.id,r.data()):null}async function d(e){return(await l(e).get()).docs.map(e=>c(e.id,e.data()))}async function f(e,t,r){let n=await d(e),a=r?.locale??r?.defaultLocale??"fr-CA";return n.find(e=>e.current.slug===t&&e.locale===a&&(0,i.C2)(e))||null}async function p(e){let t=l(e.orgId).doc(e.id),r={...e,createdAt:(0,o.B)(e.createdAt),updatedAt:(0,o.B)(e.updatedAt)};await t.set(r,{merge:!0})}async function y(e){let t=new Date().toISOString(),r={id:l(e.orgId).doc().id,orgId:e.orgId,type:"page",status:e.status,createdAt:t,updatedAt:t,createdBy:e.createdBy,updatedBy:e.createdBy,version:1,current:e.payload,history:e.history,locale:e.locale??"fr-CA",translationGroupId:e.translationGroupId??null,translations:e.translations??[],publishAt:null,unpublishAt:null,editorialStatus:null,assignment:null};return await p(r),r}[a,o]=s.then?(await s)():s,n()}catch(e){n(e)}})},5424:(e,t,r)=>{r.a(e,async(e,n)=>{try{r.d(t,{MT:()=>u,Z1:()=>f,iP:()=>d,ln:()=>p,rw:()=>c});var a=r(97681),o=r(48680),i=e([a,o]);function s(e){return a.db.collection("organizations").doc(e).collection("tags")}function l(e,t){let r={...t,id:e};return{...r,createdAt:(0,o.b)(r.createdAt),updatedAt:(0,o.b)(r.updatedAt)}}async function c(e){return(await s(e).get()).docs.map(e=>l(e.id,e.data()))}async function u(e,t){let r=await s(e).doc(t).get();return r.exists?l(r.id,r.data()):null}async function d(e,t){return(await c(e)).find(e=>e.slug===t)??null}async function f(e,t){if(0===t.length)return[];let r=[...new Set(t)],n=[];for(let t of r){let r=await u(e,t);r&&n.push(r)}return n}async function p(e,t){let r=new Date().toISOString(),n=s(e).doc(),a={id:n.id,orgId:e,name:t.name,slug:t.slug,createdAt:r,updatedAt:r};return await n.set({...a,createdAt:(0,o.B)(r),updatedAt:(0,o.B)(r)}),a}[a,o]=i.then?(await i)():i,n()}catch(e){n(e)}})},75594:(e,t,r)=>{r.a(e,async(e,n)=>{try{r.d(t,{j:()=>d});var a=r(90455),o=r(3485),i=r(83895),s=r(7331),l=r(45487),c=r(5424),u=e([a,i,s,l,c]);[a,i,s,l,c]=u.then?(await u)():u;let d={orgs:e=>({orgId:e,organization:{get:()=>(0,s.Xu)(e)},pages:{get:t=>(0,l.fx)(e,t),list:()=>(0,l.u5)(e),save:t=>(0,l.Jq)({...t,orgId:e}),create:t=>(0,l.D4)({orgId:e,createdBy:t.createdBy,payload:t.payload,status:t.status,history:t.history})},articles:{get:t=>(0,o.fq)(e,t),list:()=>(0,o.KR)(e),listPaginated:t=>(0,o.vL)(e,t),save:t=>(0,o.j8)({...t,orgId:e}),create:t=>(0,o.tu)({orgId:e,createdBy:t.createdBy,payload:t.payload,status:t.status,history:t.history,categoryId:t.categoryId,tagIds:t.tagIds,authorId:t.authorId,authorName:t.authorName})},categories:{list:()=>(0,i.kb)(e),get:t=>(0,i.ax)(e,t),create:t=>(0,i.k4)(e,t)},tags:{list:()=>(0,c.rw)(e),get:t=>(0,c.MT)(e,t),getByIds:t=>(0,c.Z1)(e,t),create:t=>(0,c.ln)(e,t)}}),async currentOrg(){let{orgId:e}=await (0,a.mk)();return this.orgs(e)},async currentOrgPages(){return(await this.currentOrg()).pages},async currentOrgArticles(){return(await this.currentOrg()).articles}};n()}catch(e){n(e)}})},32630:(e,t,r)=>{function n(e,t=new Date){if("published"!==e.status)return!1;let r=t.toISOString();return(null==e.publishAt||""===e.publishAt||!(e.publishAt>r))&&(null==e.unpublishAt||""===e.unpublishAt||!(e.unpublishAt<=r))}function a(e,t){let r=e=>{if(null==e||""===e)return null;let t=new Date(e);return Number.isNaN(t.getTime())?null:t},n=r(e),a=r(t);return null!=e&&""!==e&&null===n?{error:"Format de date invalide pour publishAt (attendu ISO date-time)"}:null!=t&&""!==t&&null===a?{error:"Format de date invalide pour unpublishAt (attendu ISO date-time)"}:null!=n&&null!=a&&n>a?{error:"publishAt ne peut pas \xeatre post\xe9rieur \xe0 unpublishAt"}:{}}function o(e,t){let r=e.supportedLocales??[],n=e.defaultLocale??"fr-CA";return t&&""!==t.trim()&&r.includes(t)?t:n}r.d(t,{C2:()=>n,RZ:()=>a,jR:()=>o})},71615:(e,t,r)=>{var n=r(88757);r.o(n,"cookies")&&r.d(t,{cookies:function(){return n.cookies}}),r.o(n,"headers")&&r.d(t,{headers:function(){return n.headers}})},33085:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"DraftMode",{enumerable:!0,get:function(){return o}});let n=r(45869),a=r(6278);class o{get isEnabled(){return this._provider.isEnabled}enable(){let e=n.staticGenerationAsyncStorage.getStore();return e&&(0,a.trackDynamicDataAccessed)(e,"draftMode().enable()"),this._provider.enable()}disable(){let e=n.staticGenerationAsyncStorage.getStore();return e&&(0,a.trackDynamicDataAccessed)(e,"draftMode().disable()"),this._provider.disable()}constructor(e){this._provider=e}}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},88757:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{cookies:function(){return f},draftMode:function(){return p},headers:function(){return d}});let n=r(68996),a=r(53047),o=r(92044),i=r(72934),s=r(33085),l=r(6278),c=r(45869),u=r(54580);function d(){let e="headers",t=c.staticGenerationAsyncStorage.getStore();if(t){if(t.forceStatic)return a.HeadersAdapter.seal(new Headers({}));(0,l.trackDynamicDataAccessed)(t,e)}return(0,u.getExpectedRequestStore)(e).headers}function f(){let e="cookies",t=c.staticGenerationAsyncStorage.getStore();if(t){if(t.forceStatic)return n.RequestCookiesAdapter.seal(new o.RequestCookies(new Headers({})));(0,l.trackDynamicDataAccessed)(t,e)}let r=(0,u.getExpectedRequestStore)(e),a=i.actionAsyncStorage.getStore();return(null==a?void 0:a.isAction)||(null==a?void 0:a.isAppRoute)?r.mutableCookies:r.cookies}function p(){let e=(0,u.getExpectedRequestStore)("draftMode");return new s.DraftMode(e.draftMode)}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},53047:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{HeadersAdapter:function(){return o},ReadonlyHeadersError:function(){return a}});let n=r(38238);class a extends Error{constructor(){super("Headers cannot be modified. Read more: https://nextjs.org/docs/app/api-reference/functions/headers")}static callable(){throw new a}}class o extends Headers{constructor(e){super(),this.headers=new Proxy(e,{get(t,r,a){if("symbol"==typeof r)return n.ReflectAdapter.get(t,r,a);let o=r.toLowerCase(),i=Object.keys(e).find(e=>e.toLowerCase()===o);if(void 0!==i)return n.ReflectAdapter.get(t,i,a)},set(t,r,a,o){if("symbol"==typeof r)return n.ReflectAdapter.set(t,r,a,o);let i=r.toLowerCase(),s=Object.keys(e).find(e=>e.toLowerCase()===i);return n.ReflectAdapter.set(t,s??r,a,o)},has(t,r){if("symbol"==typeof r)return n.ReflectAdapter.has(t,r);let a=r.toLowerCase(),o=Object.keys(e).find(e=>e.toLowerCase()===a);return void 0!==o&&n.ReflectAdapter.has(t,o)},deleteProperty(t,r){if("symbol"==typeof r)return n.ReflectAdapter.deleteProperty(t,r);let a=r.toLowerCase(),o=Object.keys(e).find(e=>e.toLowerCase()===a);return void 0===o||n.ReflectAdapter.deleteProperty(t,o)}})}static seal(e){return new Proxy(e,{get(e,t,r){switch(t){case"append":case"delete":case"set":return a.callable;default:return n.ReflectAdapter.get(e,t,r)}}})}merge(e){return Array.isArray(e)?e.join(", "):e}static from(e){return e instanceof Headers?e:new o(e)}append(e,t){let r=this.headers[e];"string"==typeof r?this.headers[e]=[r,t]:Array.isArray(r)?r.push(t):this.headers[e]=t}delete(e){delete this.headers[e]}get(e){let t=this.headers[e];return void 0!==t?this.merge(t):null}has(e){return void 0!==this.headers[e]}set(e,t){this.headers[e]=t}forEach(e,t){for(let[r,n]of this.entries())e.call(t,n,r,this)}*entries(){for(let e of Object.keys(this.headers)){let t=e.toLowerCase(),r=this.get(t);yield[t,r]}}*keys(){for(let e of Object.keys(this.headers)){let t=e.toLowerCase();yield t}}*values(){for(let e of Object.keys(this.headers)){let t=this.get(e);yield t}}[Symbol.iterator](){return this.entries()}}},68996:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{MutableRequestCookiesAdapter:function(){return d},ReadonlyRequestCookiesError:function(){return i},RequestCookiesAdapter:function(){return s},appendMutableCookies:function(){return u},getModifiedCookieValues:function(){return c}});let n=r(92044),a=r(38238),o=r(45869);class i extends Error{constructor(){super("Cookies can only be modified in a Server Action or Route Handler. Read more: https://nextjs.org/docs/app/api-reference/functions/cookies#cookiessetname-value-options")}static callable(){throw new i}}class s{static seal(e){return new Proxy(e,{get(e,t,r){switch(t){case"clear":case"delete":case"set":return i.callable;default:return a.ReflectAdapter.get(e,t,r)}}})}}let l=Symbol.for("next.mutated.cookies");function c(e){let t=e[l];return t&&Array.isArray(t)&&0!==t.length?t:[]}function u(e,t){let r=c(t);if(0===r.length)return!1;let a=new n.ResponseCookies(e),o=a.getAll();for(let e of r)a.set(e);for(let e of o)a.set(e);return!0}class d{static wrap(e,t){let r=new n.ResponseCookies(new Headers);for(let t of e.getAll())r.set(t);let i=[],s=new Set,c=()=>{let e=o.staticGenerationAsyncStorage.getStore();if(e&&(e.pathWasRevalidated=!0),i=r.getAll().filter(e=>s.has(e.name)),t){let e=[];for(let t of i){let r=new n.ResponseCookies(new Headers);r.set(t),e.push(r.toString())}t(e)}};return new Proxy(r,{get(e,t,r){switch(t){case l:return i;case"delete":return function(...t){s.add("string"==typeof t[0]?t[0]:t[0].name);try{e.delete(...t)}finally{c()}};case"set":return function(...t){s.add("string"==typeof t[0]?t[0]:t[0].name);try{return e.set(...t)}finally{c()}};default:return a.ReflectAdapter.get(e,t,r)}}})}}}};