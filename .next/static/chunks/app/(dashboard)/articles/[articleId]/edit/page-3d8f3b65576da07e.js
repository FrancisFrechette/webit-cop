(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[229],{6157:function(e,t,a){Promise.resolve().then(a.bind(a,229))},229:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return x}});var s=a(7437),r=a(2954),l=a(8011),n=a(9376),i=a(2265),c=a(7429),d=a(6901);function o(e){try{return new Date(e).toLocaleDateString("fr-FR",{day:"2-digit",month:"long",year:"numeric"})}catch(t){return e}}let u={draft:"bg-slate-600/80 text-slate-200",preview:"bg-amber-600/80 text-white",published:"bg-emerald-600/80 text-white",archived:"bg-slate-700/80 text-slate-400"},m={draft:"Brouillon",preview:"Preview interne",published:"Publi\xe9",archived:"Archiv\xe9"};function x(e){var t,a,x,h,p,b,g,f,v,j,w,y;let{params:N}=e,S=(0,n.useRouter)(),[C,k]=(0,i.useState)(null),[E,I]=(0,i.useState)([]),[A,_]=(0,i.useState)([]),[T,P]=(0,i.useState)(null),[R,O]=(0,i.useState)([]),[D,B]=(0,i.useState)(!0),[U,F]=(0,i.useState)(!1),[L,J]=(0,i.useState)(!1),[M,q]=(0,i.useState)([]),[X,z]=(0,i.useState)(null),[H,V]=(0,i.useState)([]),[G,K]=(0,i.useState)(!1),[Z,Y]=(0,i.useState)(null),[Q,W]=(0,i.useState)(null),[$,ee]=(0,i.useState)(null),[et,ea]=(0,i.useState)(!1),[es,er]=(0,i.useState)(null),[el,en]=(0,i.useState)(null),[ei,ec]=(0,i.useState)(!1),[ed,eo]=(0,i.useState)([]),[eu,em]=(0,i.useState)(""),[ex,eh]=(0,i.useState)(!1),[ep,eb]=(0,i.useState)(null),{org:eg}=(0,d.X)(),{user:ef}=(0,c.z)(),ev=U||L||et,ej="new"===N.articleId;(0,i.useEffect)(()=>{if(ej){S.replace("/articles");return}let e=!1;return(async()=>{B(!0);try{let n=await (0,r.g)(),i=await fetch("/api/orgs/current/articles/".concat(N.articleId),{headers:{...n},credentials:"include"});if(!e&&i.ok){var t,a,s,l;let e=await i.json();k(e),P(null!==(t=e.categoryId)&&void 0!==t?t:null),O(null!==(a=e.tagIds)&&void 0!==a?a:[]),er(null!==(s=e.publishAt)&&void 0!==s?s:null),en(null!==(l=e.unpublishAt)&&void 0!==l?l:null)}if(!e&&i.ok&&N.articleId){let e=await fetch("/api/orgs/current/articles/".concat(N.articleId,"/status-changes"),{headers:{...await (0,r.g)()},credentials:"include"});e.ok&&q(await e.json())}e||i.ok||(401===i.status||403===i.status?z({type:"error",text:"Non autoris\xe9."}):404===i.status&&k(null))}finally{e||B(!1)}})(),()=>{e=!0}},[N.articleId,ej,S]),(0,i.useEffect)(()=>{if(!N.articleId||"new"===N.articleId)return;let e=!1;return K(!0),(async()=>{try{let t=await (0,r.g)(),a=await fetch("/api/orgs/current/articles/".concat(N.articleId,"/versions"),{headers:{...t},credentials:"include"});if(!e&&a.ok){let e=await a.json();V(e)}}catch(t){e||z({type:"error",text:"Impossible de charger l’historique des versions."})}finally{e||K(!1)}})(),()=>{e=!0}},[N.articleId]),(0,i.useEffect)(()=>{if(ej)return;let e=!1;return(async()=>{let t=await (0,r.g)();try{let[a,s]=await Promise.all([fetch("/api/orgs/current/categories",{headers:{...t},credentials:"include"}),fetch("/api/orgs/current/tags",{headers:{...t},credentials:"include"})]);!e&&a.ok&&I(await a.json()),!e&&s.ok&&_(await s.json())}catch(e){}})(),()=>{e=!0}},[ej]),(0,i.useEffect)(()=>{if(!(null==C?void 0:C.id))return;let e=!1;return(async()=>{try{let t=await (0,r.g)(),a=await fetch("/api/orgs/current/articles/".concat(C.id,"/comments"),{headers:{...t},credentials:"include"});if(!e&&a.ok){let e=await a.json();eo(e)}}catch(e){}})(),()=>{e=!0}},[null==C?void 0:C.id]);let ew=(0,i.useRef)(C);ew.current=C;let ey=(0,i.useRef)({metaCategoryId:T,metaTagIds:R});ey.current={metaCategoryId:T,metaTagIds:R},(0,i.useEffect)(()=>{var e;if(!(null==C?void 0:C.id)||ej||!["draft","preview"].includes(null!==(e=null==C?void 0:C.status)&&void 0!==e?e:""))return;let t=setInterval(async()=>{let e=ew.current,{metaCategoryId:t,metaTagIds:a}=ey.current;if(null==e?void 0:e.id){ea(!0);try{let s=await (0,r.g)(),l=await fetch("/api/orgs/current/articles/".concat(e.id),{method:"PUT",headers:{"Content-Type":"application/json",...s},credentials:"include",body:JSON.stringify({payload:e.current,status:e.status,categoryId:t,tagIds:a})});if(l.ok){let e=await l.json();k(e),ee(new Date().toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"}))}}catch(e){}finally{ea(!1)}}},1e4);return()=>clearInterval(t)},[null==C?void 0:C.id,null==C?void 0:C.status,ej]);let eN=(0,i.useCallback)(async e=>{if((null==C?void 0:C.orgId)&&(null==C?void 0:C.id)&&("published"!==C.status||"draft"!==e&&"archived"!==e||window.confirm("archived"===e?"Archiver cet article ? Il ne sera plus visible sur le blog.":"Repasser en brouillon ? L’article ne sera plus visible sur le blog."))){z(null),F(!0);try{var t,a,s;let l=await (0,r.g)(),n=await fetch("/api/orgs/current/articles/".concat(C.id),{method:"PUT",headers:{"Content-Type":"application/json",...l},credentials:"include",body:JSON.stringify({payload:C.current,status:e,categoryId:T,tagIds:R,publishAt:null!=es?es:void 0,unpublishAt:null!=el?el:void 0})});if(!n.ok){let e=await n.json().catch(()=>({}));z({type:"error",text:null!==(t=e.error)&&void 0!==t?t:"Erreur"});return}let i=await n.json();k(i),er(null!==(a=i.publishAt)&&void 0!==a?a:null),en(null!==(s=i.unpublishAt)&&void 0!==s?s:null),z({type:"success",text:"Statut mis \xe0 jour."});let c=await fetch("/api/orgs/current/articles/".concat(C.id,"/status-changes"),{headers:{...await (0,r.g)()},credentials:"include"});c.ok&&q(await c.json())}catch(e){z({type:"error",text:"Erreur r\xe9seau."})}finally{F(!1)}}},[C,T,R,es,el]),eS=(0,i.useCallback)(async e=>{if((null==C?void 0:C.id)&&window.confirm("Vous allez restaurer une ancienne version. Cette op\xe9ration cr\xe9era une nouvelle version et \xe9crasera les modifications non sauvegard\xe9es. Continuer ?")){z(null),W(e);try{var t,a,s;let l=await (0,r.g)(),n=await fetch("/api/orgs/current/articles/".concat(C.id,"/versions/rollback"),{method:"POST",headers:{"Content-Type":"application/json",...l},credentials:"include",body:JSON.stringify({versionNumber:e})});if(!n.ok){let e=await n.json().catch(()=>({}));z({type:"error",text:null!==(t=e.error)&&void 0!==t?t:"Erreur lors de la restauration."});return}let i=await n.json();k(i),P(null!==(a=i.categoryId)&&void 0!==a?a:null),O(null!==(s=i.tagIds)&&void 0!==s?s:[]),Y(null),z({type:"success",text:"Version restaur\xe9e."});let c=await fetch("/api/orgs/current/articles/".concat(C.id,"/versions"),{headers:{...await (0,r.g)()},credentials:"include"});c.ok&&V(await c.json())}catch(e){z({type:"error",text:"Erreur r\xe9seau."})}finally{W(null)}}},[C]),eC=(0,i.useCallback)(async()=>{if(null==C?void 0:C.id){z(null),J(!0);try{var e,t,a;let s=await (0,r.g)(),l=await fetch("/api/orgs/current/articles/".concat(C.id),{method:"PUT",headers:{"Content-Type":"application/json",...s},credentials:"include",body:JSON.stringify({payload:C.current,status:C.status,categoryId:T,tagIds:R,publishAt:null!=es?es:void 0,unpublishAt:null!=el?el:void 0})});if(!l.ok){let t=await l.json().catch(()=>({}));z({type:"error",text:null!==(e=t.error)&&void 0!==e?e:"Erreur"});return}let n=await l.json();k(n),er(null!==(t=n.publishAt)&&void 0!==t?t:null),en(null!==(a=n.unpublishAt)&&void 0!==a?a:null),z({type:"success",text:"M\xe9tadonn\xe9es enregistr\xe9es."})}catch(e){z({type:"error",text:"Erreur r\xe9seau."})}finally{J(!1)}}},[C,T,R,es,el]),ek=(0,i.useCallback)(async e=>{if(null==C?void 0:C.id){eh(!0),z(null);try{let a=await (0,r.g)(),s=await fetch("/api/orgs/current/articles/".concat(C.id),{method:"PUT",headers:{"Content-Type":"application/json",...a},credentials:"include",body:JSON.stringify({payload:C.current,status:C.status,categoryId:T,tagIds:R,publishAt:null!=es?es:void 0,unpublishAt:null!=el?el:void 0,editorialStatus:void 0!==e.editorialStatus?e.editorialStatus:C.editorialStatus,assignment:void 0!==e.assignment?e.assignment:C.assignment})});if(!s.ok){var t;let e=await s.json().catch(()=>({}));z({type:"error",text:null!==(t=e.error)&&void 0!==t?t:"Erreur"});return}let l=await s.json();k(l),z({type:"success",text:"Mis \xe0 jour."})}catch(e){z({type:"error",text:"Erreur r\xe9seau."})}finally{eh(!1)}}},[C,T,R,es,el]);if(ej)return null;if(D)return(0,s.jsx)("div",{className:"layout-container py-12",children:(0,s.jsx)("p",{className:"text-webit-fg-muted",children:"Chargement…"})});if(!C)return(0,s.jsxs)("div",{className:"layout-container py-8",children:[(0,s.jsx)("p",{className:"text-webit-fg-muted",children:"Article introuvable."}),(0,s.jsx)("button",{type:"button",className:"btn-secondary mt-4",onClick:()=>S.push("/articles"),children:"Retour aux articles"})]});let eE=C.status;return(0,s.jsxs)("div",{className:"layout-container py-8",children:[(0,s.jsxs)("div",{className:"mb-6 flex flex-wrap items-center justify-between gap-2",children:[(0,s.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,s.jsx)("h1",{className:"text-3xl font-semibold text-white",children:"\xc9diter l’article"}),C.editorialStatus&&(0,s.jsx)("span",{className:"inline-flex rounded-full px-2.5 py-0.5 text-xs font-medium ".concat((0,l.Zj)(C.editorialStatus)),children:(0,l.gC)(C.editorialStatus)})]}),(0,s.jsx)("button",{type:"button",className:"btn-secondary",onClick:()=>S.push("/articles"),children:"Retour aux articles"})]}),X&&(0,s.jsx)("p",{className:"error"===X.type?"mb-4 text-webit-accent-rose":"mb-4 text-emerald-400",children:X.text}),$&&(0,s.jsxs)("p",{className:"mb-4 text-xs text-webit-fg-muted",children:["Brouillon enregistr\xe9 automatiquement \xe0 ",$,"."]}),(0,s.jsxs)("div",{className:"panel max-w-xl space-y-4",children:[(0,s.jsx)("p",{className:"text-webit-fg-muted",children:"\xc9diteur complet \xe0 venir (blocs, SEO, etc.). En attendant, vous pouvez g\xe9rer le statut de publication ci-dessous."}),(0,s.jsxs)("div",{className:"rounded-lg border border-webit-panel-border bg-slate-900/40 p-4",children:[(0,s.jsx)("p",{className:"mb-2 text-sm font-medium text-white",children:"Langue & traductions"}),(0,s.jsxs)("p",{className:"mb-2 text-xs text-webit-fg-muted",children:["Locale : ",(0,s.jsx)("span",{className:"font-mono text-white",children:null!==(a=C.locale)&&void 0!==a?a:"fr-CA"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"mb-1 text-xs text-webit-fg-muted",children:"Traductions li\xe9es"}),(0,s.jsx)("ul",{className:"mb-2 space-y-1 text-sm",children:0===(null!==(x=C.translations)&&void 0!==x?x:[]).length?(0,s.jsx)("li",{className:"text-webit-fg-muted",children:"Aucune autre locale"}):(null!==(h=C.translations)&&void 0!==h?h:[]).map(e=>(0,s.jsxs)("li",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{className:"font-mono text-white",children:e.locale}),(0,s.jsx)("a",{href:"/articles/".concat(e.id,"/edit"),className:"text-webit-accent hover:underline",children:"Ouvrir"})]},e.id))}),(null==eg?void 0:eg.supportedLocales)&&eg.supportedLocales.length>1&&(0,s.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,s.jsxs)("select",{id:"new-translation-locale-article",className:"rounded border border-webit-panel-border bg-slate-900 px-2 py-1 text-sm text-white",defaultValue:"",children:[(0,s.jsx)("option",{value:"",children:"Choisir une locale"}),eg.supportedLocales.filter(e=>{var t;return e!==C.locale&&!(null!==(t=C.translations)&&void 0!==t?t:[]).some(t=>t.locale===e)}).map(e=>(0,s.jsx)("option",{value:e,children:e},e))]}),(0,s.jsx)("button",{type:"button",className:"btn-secondary text-sm",disabled:ei,onClick:async()=>{var e,t;let a=document.getElementById("new-translation-locale-article"),s=null==a?void 0:null===(e=a.value)||void 0===e?void 0:e.trim();if(s){ec(!0);try{let e=await (0,r.g)(),a=await fetch("/api/orgs/current/articles/".concat(C.id,"/translations"),{method:"POST",headers:{"Content-Type":"application/json",...e},credentials:"include",body:JSON.stringify({targetLocale:s})});if(!a.ok){let e=await a.json().catch(()=>({}));z({type:"error",text:null!==(t=e.error)&&void 0!==t?t:"Erreur \xe0 la cr\xe9ation de la traduction."});return}let{article:l}=await a.json();k(e=>{var t;return e?{...e,translations:[...null!==(t=e.translations)&&void 0!==t?t:[],{id:l.id,locale:s}]}:e}),z({type:"success",text:"Traduction cr\xe9\xe9e."}),window.location.href="/articles/".concat(l.id,"/edit")}catch(e){z({type:"error",text:"Erreur r\xe9seau."})}finally{ec(!1)}}},children:ei?"Cr\xe9ation…":"Cr\xe9er une traduction"})]})]})]}),(0,s.jsxs)("div",{className:"rounded-lg border border-webit-panel-border bg-slate-900/40 p-4",children:[(0,s.jsx)("p",{className:"mb-3 text-sm font-medium text-white",children:"Collaboration"}),(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsx)("p",{className:"mb-1 text-xs text-webit-fg-muted",children:"Assign\xe9 \xe0"}),(0,s.jsx)("p",{className:"text-sm text-white",children:null!==(p=null===(t=C.assignment)||void 0===t?void 0:t.assigneeUserName)&&void 0!==p?p:"Personne"}),(0,s.jsxs)("div",{className:"mt-2 flex gap-2",children:[(0,s.jsx)("button",{type:"button",className:"btn-secondary text-sm",disabled:ex||!ef,onClick:()=>{var e,t,a;return ek({assignment:{assigneeUserId:null!==(e=null==ef?void 0:ef.uid)&&void 0!==e?e:null,assigneeUserName:null!==(a=null!==(t=null==ef?void 0:ef.displayName)&&void 0!==t?t:null==ef?void 0:ef.email)&&void 0!==a?a:null}})},children:"M'assigner"}),(0,s.jsx)("button",{type:"button",className:"btn-secondary text-sm",disabled:ex,onClick:()=>ek({assignment:null}),children:"Retirer l'assignation"})]})]}),(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsx)("label",{className:"mb-1 block text-xs text-webit-fg-muted",children:"Statut de revue \xe9ditoriale"}),(0,s.jsx)("select",{className:"w-full rounded border border-webit-panel-border bg-slate-900 px-2 py-1.5 text-sm text-white",value:null!==(b=C.editorialStatus)&&void 0!==b?b:"not_needed",onChange:e=>ek({editorialStatus:e.target.value||"not_needed"}),disabled:ex,children:Object.keys(l.wR).map(e=>(0,s.jsx)("option",{value:e,children:l.wR[e]},e))})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"mb-2 text-xs text-webit-fg-muted",children:"Commentaires"}),(0,s.jsx)("ul",{className:"mb-3 space-y-2",children:ed.map(e=>{var t;return(0,s.jsxs)("li",{className:"rounded border border-webit-panel-border/60 bg-slate-800/40 px-3 py-2 text-sm ".concat(e.resolved?"opacity-75":""),children:[(0,s.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-1",children:[(0,s.jsx)("span",{className:"font-medium text-white",children:null!==(t=e.authorUserName)&&void 0!==t?t:"Anonyme"}),(0,s.jsxs)("span",{className:"text-xs text-webit-fg-muted",children:[new Date(e.createdAt).toLocaleString("fr-FR"),e.resolved&&(0,s.jsx)("span",{className:"ml-2 rounded bg-emerald-600/80 px-1.5 py-0.5 text-white",children:"R\xe9solu"})]})]}),(0,s.jsx)("p",{className:"mt-1 text-webit-fg-muted",children:e.body}),!e.resolved&&(0,s.jsx)("button",{type:"button",className:"mt-2 text-xs text-webit-accent hover:underline disabled:opacity-50",disabled:null!==ep,onClick:async()=>{eb(e.id);try{let t=await (0,r.g)();if((await fetch("/api/orgs/current/articles/".concat(C.id,"/comments/").concat(e.id),{method:"PATCH",headers:{"Content-Type":"application/json",...t},credentials:"include",body:JSON.stringify({resolved:!0})})).ok){let e=await fetch("/api/orgs/current/articles/".concat(C.id,"/comments"),{headers:{...await (0,r.g)()},credentials:"include"}).then(e=>e.json());eo(e)}}finally{eb(null)}},children:ep===e.id?"…":"Marquer comme r\xe9solu"})]},e.id)})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("textarea",{className:"mb-2 w-full rounded border border-webit-panel-border bg-slate-900 px-2 py-1.5 text-sm text-white",rows:2,placeholder:"Ajouter un commentaire…",value:eu,onChange:e=>em(e.target.value)}),(0,s.jsx)("button",{type:"button",className:"btn-secondary text-sm",disabled:!eu.trim(),onClick:async()=>{let e=eu.trim();if(!e)return;let t=await (0,r.g)(),a=await fetch("/api/orgs/current/articles/".concat(C.id,"/comments"),{method:"POST",headers:{"Content-Type":"application/json",...t},credentials:"include",body:JSON.stringify({body:e})});if(!a.ok){var s;z({type:"error",text:null!==(s=(await a.json().catch(()=>({}))).error)&&void 0!==s?s:"Erreur."});return}let l=await a.json();eo(e=>[...e,l]),em("")},children:"Commenter"})]})]})]}),(0,s.jsxs)("div",{className:"rounded-lg border border-webit-panel-border bg-slate-900/40 p-4",children:[(0,s.jsx)("p",{className:"mb-2 text-sm font-medium text-white",children:"Publication"}),(0,s.jsx)("div",{className:"mb-3 flex items-center gap-2",children:(0,s.jsx)("span",{className:"inline-flex rounded-full px-2.5 py-0.5 text-xs font-medium ".concat(u[eE]),children:m[eE]})}),(0,s.jsxs)("div",{className:"mb-4 grid gap-2 text-sm",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"mb-0.5 block text-xs text-webit-fg-muted",children:"Publier \xe0 partir de"}),(0,s.jsx)("input",{type:"datetime-local",className:"w-full rounded border border-webit-panel-border bg-slate-900 px-2 py-1.5 text-white",value:es?es.slice(0,16):"",onChange:e=>er(e.target.value?new Date(e.target.value).toISOString():null)})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"mb-0.5 block text-xs text-webit-fg-muted",children:"D\xe9publier \xe0"}),(0,s.jsx)("input",{type:"datetime-local",className:"w-full rounded border border-webit-panel-border bg-slate-900 px-2 py-1.5 text-white",value:el?el.slice(0,16):"",onChange:e=>en(e.target.value?new Date(e.target.value).toISOString():null)})]}),es&&new Date(es)>new Date&&(0,s.jsxs)("p",{className:"text-xs text-amber-400",children:["Publication planifi\xe9e le ",new Date(es).toLocaleString("fr-FR")]}),el&&(0,s.jsxs)("p",{className:"text-xs text-webit-fg-muted",children:["Sera d\xe9publi\xe9 le ",new Date(el).toLocaleString("fr-FR")]})]}),(0,s.jsxs)("div",{className:"mb-4 space-y-1 text-xs text-webit-fg-muted",children:[C.current.publishedAt&&(0,s.jsxs)("p",{children:["Publi\xe9 le : ",o(C.current.publishedAt)]}),(0,s.jsxs)("p",{children:["Derni\xe8re mise \xe0 jour : ",o(C.updatedAt)]})]}),M.length>0&&(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsx)("p",{className:"mb-2 text-xs font-medium text-webit-fg-muted",children:"Historique des statuts"}),(0,s.jsx)("ul",{className:"space-y-1 text-xs text-webit-fg-muted",children:M.map(e=>(0,s.jsxs)("li",{children:[o(e.changedAt)," –"," ",e.fromStatus&&m[e.fromStatus]||"—"," →"," ",m[e.toStatus],e.changedByUserName&&" par ".concat(e.changedByUserName)]},e.id))})]}),(0,s.jsxs)("div",{className:"flex flex-wrap gap-2",children:["draft"===eE&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("button",{type:"button",className:"btn-secondary text-sm",onClick:()=>eN("preview"),disabled:ev,children:"Passer en preview"}),(0,s.jsx)("button",{type:"button",className:"btn-primary text-sm",onClick:()=>eN("published"),disabled:ev,children:"Publier"})]}),"preview"===eE&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("button",{type:"button",className:"btn-secondary text-sm",onClick:()=>eN("draft"),disabled:ev,children:"Repasser en brouillon"}),(0,s.jsx)("button",{type:"button",className:"btn-primary text-sm",onClick:()=>eN("published"),disabled:ev,children:"Publier"})]}),"published"===eE&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("button",{type:"button",className:"btn-secondary text-sm",onClick:()=>eN("draft"),disabled:ev,children:"Repasser en brouillon"}),(0,s.jsx)("button",{type:"button",className:"btn-secondary text-sm",onClick:()=>eN("archived"),disabled:ev,children:"Archiver"})]}),"archived"===eE&&(0,s.jsx)("button",{type:"button",className:"btn-secondary text-sm",onClick:()=>eN("draft"),disabled:ev,children:"Repasser en brouillon"})]})]}),(0,s.jsxs)("div",{className:"rounded-lg border border-webit-panel-border bg-slate-900/40 p-4",children:[(0,s.jsx)("p",{className:"mb-3 text-sm font-medium text-white",children:"Historique des versions"}),G?(0,s.jsx)("p",{className:"text-xs text-webit-fg-muted",children:"Chargement…"}):0===H.length?(0,s.jsx)("p",{className:"text-xs text-webit-fg-muted",children:"Aucune version enregistr\xe9e."}):(0,s.jsx)("ul",{className:"mb-4 space-y-2",children:H.map(e=>(0,s.jsxs)("li",{className:"flex flex-wrap items-center justify-between gap-2 rounded border border-webit-panel-border/60 bg-slate-800/40 px-3 py-2 text-sm",children:[(0,s.jsxs)("span",{className:"text-white",children:["Version ",e.versionNumber," \xb7 ",o(e.createdAt),e.createdByUserName&&" \xb7 ".concat(e.createdByUserName)]}),(0,s.jsxs)("span",{className:"flex gap-2",children:[(0,s.jsx)("button",{type:"button",className:"text-webit-accent hover:underline",onClick:()=>Y((null==Z?void 0:Z.id)===e.id?null:e),children:(null==Z?void 0:Z.id)===e.id?"Masquer la comparaison":"Comparer \xe0 actuel"}),(0,s.jsx)("button",{type:"button",className:"text-webit-accent-rose hover:underline disabled:opacity-50",onClick:()=>eS(e.versionNumber),disabled:null!==Q,children:Q===e.versionNumber?"Restauration…":"Restaurer cette version"})]})]},e.id))}),Z&&C&&(0,s.jsxs)("div",{className:"rounded border border-webit-panel-border bg-slate-950/60 p-3 text-xs",children:[(0,s.jsxs)("p",{className:"mb-2 font-medium text-webit-fg-muted",children:["Diff (version ",Z.versionNumber," vs actuel)"]}),(0,s.jsxs)("dl",{className:"space-y-1",children:[Z.payload.title!==C.current.title&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("dt",{className:"text-webit-fg-muted",children:"Titre"}),(0,s.jsxs)("dd",{className:"ml-4",children:[(0,s.jsx)("span",{className:"line-through text-red-300",children:Z.payload.title||"—"})," → ",(0,s.jsx)("span",{className:"text-emerald-300",children:C.current.title||"—"})]})]}),Z.payload.slug!==C.current.slug&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("dt",{className:"text-webit-fg-muted",children:"Slug"}),(0,s.jsxs)("dd",{className:"ml-4",children:[(0,s.jsx)("span",{className:"line-through text-red-300",children:Z.payload.slug||"—"})," → ",(0,s.jsx)("span",{className:"text-emerald-300",children:C.current.slug||"—"})]})]}),(null!==(g=Z.payload.seoTitle)&&void 0!==g?g:"")!==(null!==(f=C.current.seoTitle)&&void 0!==f?f:"")&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("dt",{className:"text-webit-fg-muted",children:"SEO Title"}),(0,s.jsxs)("dd",{className:"ml-4",children:[(0,s.jsx)("span",{className:"line-through text-red-300",children:Z.payload.seoTitle||"—"})," → ",(0,s.jsx)("span",{className:"text-emerald-300",children:C.current.seoTitle||"—"})]})]}),(null!==(v=Z.payload.seoDescription)&&void 0!==v?v:"")!==(null!==(j=C.current.seoDescription)&&void 0!==j?j:"")&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("dt",{className:"text-webit-fg-muted",children:"SEO Description"}),(0,s.jsxs)("dd",{className:"ml-4 truncate",children:[(0,s.jsx)("span",{className:"line-through text-red-300",children:Z.payload.seoDescription||"—"})," → ",(0,s.jsx)("span",{className:"text-emerald-300",children:C.current.seoDescription||"—"})]})]}),JSON.stringify(null!==(w=Z.payload.blocks)&&void 0!==w?w:[])!==JSON.stringify(null!==(y=C.current.blocks)&&void 0!==y?y:[])&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("dt",{className:"text-webit-fg-muted",children:"Blocs"}),(0,s.jsx)("dd",{className:"ml-4 text-webit-fg-muted",children:"Contenu modifi\xe9"})]})]})]})]}),(0,s.jsxs)("div",{className:"rounded-lg border border-webit-panel-border bg-slate-900/40 p-4",children:[(0,s.jsx)("p",{className:"mb-3 text-sm font-medium text-white",children:"M\xe9tadonn\xe9es"}),(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"mb-1 block text-xs text-webit-fg-muted",children:"Cat\xe9gorie"}),(0,s.jsxs)("select",{className:"w-full rounded border border-webit-panel-border bg-slate-900 px-3 py-2 text-sm text-white",value:null!=T?T:"",onChange:e=>P(e.target.value||null),children:[(0,s.jsx)("option",{value:"",children:"Aucune"}),E.map(e=>(0,s.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"mb-2 block text-xs text-webit-fg-muted",children:"Tags"}),(0,s.jsxs)("div",{className:"flex flex-wrap gap-2",children:[A.map(e=>(0,s.jsxs)("label",{className:"flex cursor-pointer items-center gap-1.5 text-sm text-white",children:[(0,s.jsx)("input",{type:"checkbox",checked:R.includes(e.id),onChange:t=>{t.target.checked?O(t=>[...t,e.id]):O(t=>t.filter(t=>t!==e.id))},className:"rounded border-webit-panel-border"}),e.name]},e.id)),0===A.length&&(0,s.jsx)("span",{className:"text-xs text-webit-fg-muted",children:"Aucun tag cr\xe9\xe9."})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"mb-1 block text-xs text-webit-fg-muted",children:"Auteur"}),(0,s.jsx)("p",{className:"text-sm text-white",children:C.authorName||C.authorId||"—"})]})]}),(0,s.jsx)("button",{type:"button",className:"btn-primary mt-3 text-sm",onClick:eC,disabled:L,children:L?"Enregistrement…":"Enregistrer les m\xe9tadonn\xe9es"})]})]})]})}},469:function(e,t,a){"use strict";a.d(t,{v9:function(){return i}});var s=a(738),r=a(3301),l=a(257);let n={apiKey:l.env.NEXT_PUBLIC_FIREBASE_API_KEY,authDomain:l.env.NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN,projectId:l.env.NEXT_PUBLIC_FIREBASE_PROJECT_ID,storageBucket:l.env.NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET,messagingSenderId:l.env.NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID,appId:l.env.NEXT_PUBLIC_FIREBASE_APP_ID};function i(){return(0,r.v0)(0===(0,s.C6)().length?(0,s.ZF)(n):(0,s.Mq)())}},2954:function(e,t,a){"use strict";a.d(t,{g:function(){return r}});var s=a(469);async function r(){try{let e=(0,s.v9)().currentUser;if(!e)return{};let t=await e.getIdToken();return{Authorization:"Bearer ".concat(t)}}catch(e){return{}}}},7429:function(e,t,a){"use strict";a.d(t,{z:function(){return l}});var s=a(2265),r=a(469);function l(){let[e,t]=(0,s.useState)(null),[a,l]=(0,s.useState)(!0),[n,i]=(0,s.useState)(null);return(0,s.useEffect)(()=>{let e=(0,r.v9)().onAuthStateChanged(e=>{t(null!=e?e:null),i(null),l(!1)},e=>{i(e instanceof Error?e:Error(String(e))),t(null),l(!1)});return()=>e()},[]),{user:e,loading:a,error:n}}},6901:function(e,t,a){"use strict";a.d(t,{X:function(){return l}});var s=a(2954),r=a(2265);function l(){let[e,t]=(0,r.useState)(null),[a,l]=(0,r.useState)(!0),[n,i]=(0,r.useState)(null),c=(0,r.useCallback)(async()=>{i(null),l(!0);try{let e=await (0,s.g)(),a=await fetch("/api/orgs/current",{headers:{...e},credentials:"include"});if(401===a.status||403===a.status){t(null),i("Non autoris\xe9");return}if(404===a.status){t(null),i("Organisation non trouv\xe9e");return}if(!a.ok){t(null),i("Erreur au chargement");return}let r=await a.json();t(r)}catch(e){t(null),i("Erreur r\xe9seau")}finally{l(!1)}},[]);return(0,r.useEffect)(()=>{c()},[c]),{org:e,loading:a,error:n,refetch:c}}},8011:function(e,t,a){"use strict";a.d(t,{Zj:function(){return n},gC:function(){return l},wR:function(){return s}});let s={not_needed:"Aucune revue n\xe9cessaire",in_review:"En revue",changes_requested:"Modifications demand\xe9es",approved:"Approuv\xe9"},r={not_needed:"bg-slate-600/80 text-slate-200",in_review:"bg-amber-600/80 text-white",changes_requested:"bg-rose-600/80 text-white",approved:"bg-emerald-600/80 text-white"};function l(e){var t;return null==e?"—":null!==(t=s[e])&&void 0!==t?t:e}function n(e){var t;return null==e?"bg-slate-600/80 text-slate-400":null!==(t=r[e])&&void 0!==t?t:"bg-slate-600/80 text-slate-300"}},9376:function(e,t,a){"use strict";var s=a(5475);a.o(s,"useParams")&&a.d(t,{useParams:function(){return s.useParams}}),a.o(s,"usePathname")&&a.d(t,{usePathname:function(){return s.usePathname}}),a.o(s,"useRouter")&&a.d(t,{useRouter:function(){return s.useRouter}})}},function(e){e.O(0,[139,685,971,117,744],function(){return e(e.s=6157)}),_N_E=e.O()}]);