(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[171],{6640:function(e,t,a){Promise.resolve().then(a.bind(a,5461))},5125:function(e,t,a){"use strict";a.d(t,{N:function(){return c}});var s=a(7437),r=a(8011);function n(e){var t;return{id:e.id,title:e.current.title,slug:e.current.slug,status:e.status,updatedAt:e.updatedAt,editorialStatus:null!==(t=e.editorialStatus)&&void 0!==t?t:null}}function i(e){var t;return{id:e.id,title:e.current.title,slug:e.current.slug,status:e.status,updatedAt:e.updatedAt,publishedAt:e.current.publishedAt,editorialStatus:null!==(t=e.editorialStatus)&&void 0!==t?t:null}}function l(e){try{return new Date(e).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric"})}catch(t){return e}}function u(e){let{status:t}=e;return(0,s.jsx)("span",{className:"inline-flex rounded-full px-2.5 py-0.5 text-xs font-medium ".concat({draft:"bg-slate-600/80 text-slate-200",preview:"bg-amber-600/80 text-white",published:"bg-emerald-600/80 text-white",archived:"bg-slate-700/80 text-slate-400"}[t]),children:{draft:"Brouillon",preview:"Preview",published:"Publi\xe9",archived:"Archiv\xe9"}[t]})}function c(e){let{pages:t,articles:a,onRowClick:c,onDateSortClick:d,dateSortDirection:o="desc"}=e,h=void 0!==t?t.map(n):void 0!==a?a.map(i):[],m=void 0!==a;return(0,s.jsxs)("div",{className:"overflow-x-auto",children:[(0,s.jsxs)("table",{className:"w-full text-left text-sm",children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{className:"border-b border-webit-panel-border text-webit-fg-muted",children:[(0,s.jsx)("th",{className:"pb-3 pr-4 font-medium",children:"Titre"}),(0,s.jsx)("th",{className:"pb-3 pr-4 font-medium",children:"Slug"}),(0,s.jsx)("th",{className:"pb-3 pr-4 font-medium",children:"Statut"}),m&&(0,s.jsx)("th",{className:"pb-3 pr-4 font-medium",children:d?(0,s.jsxs)("button",{type:"button",onClick:e=>{e.stopPropagation(),d()},className:"flex items-center gap-1 hover:text-white focus:outline-none","aria-label":"Trier par date ".concat("desc"===o?"croissante":"d\xe9croissante"),children:["Publication",(0,s.jsx)("span",{"aria-hidden":!0,children:"desc"===o?"↓":"↑"})]}):"Publication"}),(0,s.jsx)("th",{className:"pb-3 font-medium",children:"Derni\xe8re maj"})]})}),(0,s.jsx)("tbody",{children:h.map(e=>(0,s.jsxs)("tr",{className:"cursor-pointer border-b border-webit-panel-border/60 transition hover:bg-slate-800/50",onClick:()=>c(e.id),children:[(0,s.jsx)("td",{className:"py-3 pr-4 font-medium text-white",children:e.title||"(Sans titre)"}),(0,s.jsx)("td",{className:"py-3 pr-4 text-webit-fg-muted",children:e.slug||"—"}),(0,s.jsx)("td",{className:"py-3 pr-4",children:(0,s.jsxs)("div",{className:"flex flex-wrap items-center gap-1.5",children:[(0,s.jsx)(u,{status:e.status}),"editorialStatus"in e&&e.editorialStatus&&(0,s.jsx)("span",{className:"inline-flex rounded-full px-2 py-0.5 text-xs ".concat((0,r.Zj)(e.editorialStatus)),title:(0,r.gC)(e.editorialStatus),children:(0,r.gC)(e.editorialStatus)})]})}),m&&(0,s.jsx)("td",{className:"py-3 pr-4 text-webit-fg-muted",children:"publishedAt"in e&&"string"==typeof e.publishedAt&&e.publishedAt?l(e.publishedAt):"—"}),(0,s.jsx)("td",{className:"py-3 text-webit-fg-muted",children:l(e.updatedAt)})]},e.id))})]}),0===h.length&&(0,s.jsx)("p",{className:"py-8 text-center text-webit-fg-muted",children:"Aucun contenu."})]})}},5461:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return c}});var s=a(7437),r=a(2954),n=a(9376),i=a(2265),l=a(5125);let u=[{value:"all",label:"Tous"},{value:"draft",label:"Brouillons"},{value:"preview",label:"Preview"},{value:"published",label:"Publi\xe9s"},{value:"archived",label:"Archiv\xe9s"}];function c(){let e=(0,n.useRouter)(),[t,a]=(0,i.useState)([]),[c,d]=(0,i.useState)(!0),[o,h]=(0,i.useState)(null),[m,p]=(0,i.useState)("all"),[b,x]=(0,i.useState)("desc"),[f,v]=(0,i.useState)(""),g=(0,i.useCallback)(async()=>{h(null),d(!0);try{var e;let t=new URLSearchParams;t.set("limit","50"),"all"!==m&&t.set("status",m),t.set("orderBy","publishedAt"),t.set("direction",b),f&&t.set("author",f);let s=await (0,r.g)(),n=await fetch("/api/orgs/current/articles?".concat(t.toString()),{headers:{...s},credentials:"include"});if(401===n.status||403===n.status){h("Vous n’\xeates pas autoris\xe9 \xe0 voir cette liste."),a([]);return}if(!n.ok){h("Erreur au chargement des articles.");return}let i=await n.json();a(null!==(e=i.items)&&void 0!==e?e:[])}catch(e){h("Erreur r\xe9seau.")}finally{d(!1)}},[m,b,f]);(0,i.useEffect)(()=>{g()},[g]);let N=(0,i.useMemo)(()=>{let e=new Set,a=[];for(let i of t){var s,r,n;let t=null!==(s=i.authorId)&&void 0!==s?s:"";!t||e.has(t)||(e.add(t),a.push({id:t,name:null!==(n=null!==(r=i.authorName)&&void 0!==r?r:i.authorId)&&void 0!==n?n:"Auteur"}))}return a},[t]),j=(0,i.useMemo)(()=>t.filter(e=>"published"===e.status).length,[t]),w=(0,i.useCallback)(t=>{e.push("/articles/".concat(t,"/edit"))},[e]),_=(0,i.useCallback)(()=>{x(e=>"desc"===e?"asc":"desc")},[]);return c&&0===t.length?(0,s.jsx)("div",{className:"layout-container py-12",children:(0,s.jsx)("p",{className:"text-webit-fg-muted",children:"Chargement…"})}):(0,s.jsxs)("div",{className:"layout-container py-8",children:[(0,s.jsxs)("div",{className:"mb-6 flex items-center justify-between",children:[(0,s.jsx)("h1",{className:"text-3xl font-semibold text-white",children:"Articles"}),(0,s.jsx)("button",{type:"button",className:"btn-primary",onClick:()=>e.push("/articles/new/edit"),children:"Nouvel article"})]}),o&&(0,s.jsx)("p",{className:"mb-4 text-webit-accent-rose",children:o}),(0,s.jsxs)("div",{className:"mb-4 flex flex-wrap items-center gap-3",children:[(0,s.jsxs)("span",{className:"text-sm text-webit-fg-muted",children:[t.length," article",1!==t.length?"s":"",j!==t.length&&(0,s.jsxs)(s.Fragment,{children:[" \xb7 ",j," publi\xe9",1!==j?"s":""]})]}),(0,s.jsx)("div",{className:"flex flex-wrap gap-2",children:u.map(e=>(0,s.jsx)("button",{type:"button",className:m===e.value?"btn-primary text-sm":"btn-secondary text-sm",onClick:()=>p(e.value),children:e.label},e.value))}),N.length>0&&(0,s.jsxs)("select",{value:f,onChange:e=>v(e.target.value),className:"rounded border border-webit-panel-border bg-slate-800/60 px-3 py-1.5 text-sm text-white focus:border-webit-accent focus:outline-none","aria-label":"Filtrer par auteur",children:[(0,s.jsx)("option",{value:"",children:"Tous les auteurs"}),N.map(e=>(0,s.jsx)("option",{value:e.id,children:e.name||e.id},e.id))]})]}),(0,s.jsx)("div",{className:"panel",children:(0,s.jsx)(l.N,{articles:t,onRowClick:w,onDateSortClick:_,dateSortDirection:b})})]})}},469:function(e,t,a){"use strict";a.d(t,{v9:function(){return l}});var s=a(738),r=a(3301),n=a(257);let i={apiKey:n.env.NEXT_PUBLIC_FIREBASE_API_KEY,authDomain:n.env.NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN,projectId:n.env.NEXT_PUBLIC_FIREBASE_PROJECT_ID,storageBucket:n.env.NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET,messagingSenderId:n.env.NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID,appId:n.env.NEXT_PUBLIC_FIREBASE_APP_ID};function l(){return(0,r.v0)(0===(0,s.C6)().length?(0,s.ZF)(i):(0,s.Mq)())}},2954:function(e,t,a){"use strict";a.d(t,{g:function(){return r}});var s=a(469);async function r(){try{let e=(0,s.v9)().currentUser;if(!e)return{};let t=await e.getIdToken();return{Authorization:"Bearer ".concat(t)}}catch(e){return{}}}},8011:function(e,t,a){"use strict";a.d(t,{Zj:function(){return i},gC:function(){return n},wR:function(){return s}});let s={not_needed:"Aucune revue n\xe9cessaire",in_review:"En revue",changes_requested:"Modifications demand\xe9es",approved:"Approuv\xe9"},r={not_needed:"bg-slate-600/80 text-slate-200",in_review:"bg-amber-600/80 text-white",changes_requested:"bg-rose-600/80 text-white",approved:"bg-emerald-600/80 text-white"};function n(e){var t;return null==e?"—":null!==(t=s[e])&&void 0!==t?t:e}function i(e){var t;return null==e?"bg-slate-600/80 text-slate-400":null!==(t=r[e])&&void 0!==t?t:"bg-slate-600/80 text-slate-300"}},9376:function(e,t,a){"use strict";var s=a(5475);a.o(s,"useParams")&&a.d(t,{useParams:function(){return s.useParams}}),a.o(s,"usePathname")&&a.d(t,{usePathname:function(){return s.usePathname}}),a.o(s,"useRouter")&&a.d(t,{useRouter:function(){return s.useRouter}})}},function(e){e.O(0,[139,685,971,117,744],function(){return e(e.s=6640)}),_N_E=e.O()}]);