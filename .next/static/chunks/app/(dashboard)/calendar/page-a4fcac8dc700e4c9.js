(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[645],{4816:function(e,t,s){Promise.resolve().then(s.bind(s,881))},881:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return u}});var a=s(7437),n=s(2954),r=s(9376),l=s(2265),i=s(6901);function u(){let e=(0,r.useRouter)(),{org:t}=(0,i.X)(),[s,u]=(0,l.useState)([]),[c,o]=(0,l.useState)(!0),[d,p]=(0,l.useState)(null),[h,m]=(0,l.useState)("all"),[x,f]=(0,l.useState)(""),[b,g]=(0,l.useState)(()=>{let e=new Date;return e.setDate(1),e.setHours(0,0,0,0),e}),v=(0,l.useMemo)(()=>b.toISOString().slice(0,10),[b]),w=(0,l.useMemo)(()=>{let e=new Date(b);return e.setMonth(e.getMonth()+1),e.setDate(0),e.toISOString().slice(0,10)},[b]),N=(0,l.useCallback)(async()=>{p(null),o(!0);try{let t=await (0,n.g)(),s=new URLSearchParams;s.set("from",v),s.set("to",w),"all"!==h&&s.set("type",h),x&&s.set("locale",x);let a=await fetch("/api/orgs/current/calendar?".concat(s.toString()),{headers:{...t},credentials:"include"});if(401===a.status||403===a.status){p("Vous n’\xeates pas autoris\xe9."),u([]);return}if(!a.ok){var e;let t=await a.json().catch(()=>({}));p(null!==(e=t.error)&&void 0!==e?e:"Erreur au chargement.");return}let r=await a.json();u(r.items)}catch(e){p("Erreur r\xe9seau.")}finally{o(!1)}},[v,w,h,x]);(0,l.useEffect)(()=>{N()},[N]);let j=(0,l.useMemo)(()=>{let e=new Map;for(let t of s){if(t.publishAt){let s=t.publishAt.slice(0,10);e.has(s)||e.set(s,[]),e.get(s).push(t)}if(t.unpublishAt&&t.unpublishAt!==t.publishAt){let s=t.unpublishAt.slice(0,10);e.has(s)||e.set(s,[]),e.get(s).some(e=>e.id===t.id&&e.type===t.type)||e.get(s).push(t)}if(!t.publishAt&&!t.unpublishAt&&"published"===t.status){let s="live";e.has(s)||e.set(s,[]),e.get(s).push(t)}}return Array.from(e.entries()).sort((e,t)=>{let[s]=e,[a]=t;return"live"===s?1:"live"===a?-1:s.localeCompare(a)})},[s]),y=e=>"page"===e.type?"/pages/".concat(e.id,"/edit"):"/articles/".concat(e.id,"/edit");return(0,a.jsxs)("div",{className:"layout-container py-8",children:[(0,a.jsx)("div",{className:"mb-6 flex flex-wrap items-center justify-between gap-4",children:(0,a.jsx)("h1",{className:"text-3xl font-semibold text-white",children:"Calendrier \xe9ditorial"})}),d&&(0,a.jsx)("p",{className:"mb-4 text-webit-accent-rose",children:d}),(0,a.jsxs)("div",{className:"mb-4 flex flex-wrap items-center gap-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("button",{type:"button",className:"btn-secondary text-sm",onClick:()=>{g(e=>{let t=new Date(e);return t.setMonth(t.getMonth()-1),t})},"aria-label":"Mois pr\xe9c\xe9dent",children:"←"}),(0,a.jsx)("span",{className:"min-w-[180px] text-center font-medium text-white",children:b.toLocaleDateString("fr-FR",{month:"long",year:"numeric"})}),(0,a.jsx)("button",{type:"button",className:"btn-secondary text-sm",onClick:()=>{g(e=>{let t=new Date(e);return t.setMonth(t.getMonth()+1),t})},"aria-label":"Mois suivant",children:"→"})]}),(0,a.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,a.jsx)("label",{className:"text-sm text-webit-fg-muted",children:"Type :"}),(0,a.jsxs)("select",{className:"rounded border border-webit-panel-border bg-slate-900 px-2 py-1 text-sm text-white",value:h,onChange:e=>m(e.target.value),children:[(0,a.jsx)("option",{value:"all",children:"Tous"}),(0,a.jsx)("option",{value:"page",children:"Pages"}),(0,a.jsx)("option",{value:"article",children:"Articles"})]}),(null==t?void 0:t.supportedLocales)&&t.supportedLocales.length>1&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("label",{className:"ml-2 text-sm text-webit-fg-muted",children:"Locale :"}),(0,a.jsxs)("select",{className:"rounded border border-webit-panel-border bg-slate-900 px-2 py-1 text-sm text-white",value:x,onChange:e=>f(e.target.value),children:[(0,a.jsx)("option",{value:"",children:"Toutes"}),t.supportedLocales.map(e=>(0,a.jsx)("option",{value:e,children:e},e))]})]})]})]}),c?(0,a.jsx)("p",{className:"text-webit-fg-muted",children:"Chargement…"}):0===j.length?(0,a.jsx)("p",{className:"text-webit-fg-muted",children:"Aucun contenu planifi\xe9 ou publi\xe9 sur cette p\xe9riode."}):(0,a.jsx)("div",{className:"space-y-6",children:j.map(t=>{let[s,n]=t;return(0,a.jsxs)("div",{className:"rounded-lg border border-webit-panel-border bg-slate-900/40 p-4",children:[(0,a.jsx)("h2",{className:"mb-3 text-sm font-medium text-white",children:"live"===s?"Publi\xe9 (sans date de planification)":function(e){try{return new Date(e).toLocaleDateString("fr-FR",{weekday:"long",day:"numeric",month:"long",year:"numeric"})}catch(t){return e}}(s+"T12:00:00.000Z")}),(0,a.jsx)("ul",{className:"space-y-2",children:n.map(t=>(0,a.jsx)("li",{children:(0,a.jsxs)("a",{href:y(t),onClick:s=>{s.preventDefault(),e.push(y(t))},className:"flex flex-wrap items-center gap-2 rounded border border-webit-panel-border/60 bg-slate-800/40 px-3 py-2 text-sm text-white transition hover:border-webit-accent/50 hover:bg-slate-800/80",children:[(0,a.jsx)("span",{className:"inline-flex rounded px-1.5 py-0.5 text-xs font-medium",title:"page"===t.type?"Page":"Article",children:"page"===t.type?"\uD83D\uDCC4":"\uD83D\uDCDD"}),(0,a.jsx)("span",{className:"font-mono text-webit-fg-muted",children:t.locale}),(0,a.jsx)("span",{className:"flex-1 truncate",children:t.title||t.slug||"Sans titre"}),t.publishAt&&s===t.publishAt.slice(0,10)&&(0,a.jsx)("span",{className:"text-xs text-emerald-400",children:"Publier"}),t.unpublishAt&&s===t.unpublishAt.slice(0,10)&&(0,a.jsx)("span",{className:"text-xs text-amber-400",children:"D\xe9publier"}),"published"===t.status&&(0,a.jsx)("span",{className:"rounded bg-emerald-600/80 px-1.5 py-0.5 text-xs text-white",children:"Publi\xe9"}),"in_review"===t.editorialStatus&&(0,a.jsx)("span",{className:"text-amber-400",title:"En revue",children:"⚠"}),"changes_requested"===t.editorialStatus&&(0,a.jsx)("span",{className:"text-rose-400",title:"Modifications demand\xe9es",children:"!"}),"approved"===t.editorialStatus&&(0,a.jsx)("span",{className:"text-emerald-400",title:"Approuv\xe9",children:"✓"})]})},"".concat(t.type,"-").concat(t.id)))})]},s)})})]})}},469:function(e,t,s){"use strict";s.d(t,{v9:function(){return i}});var a=s(738),n=s(3301),r=s(257);let l={apiKey:r.env.NEXT_PUBLIC_FIREBASE_API_KEY,authDomain:r.env.NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN,projectId:r.env.NEXT_PUBLIC_FIREBASE_PROJECT_ID,storageBucket:r.env.NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET,messagingSenderId:r.env.NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID,appId:r.env.NEXT_PUBLIC_FIREBASE_APP_ID};function i(){return(0,n.v0)(0===(0,a.C6)().length?(0,a.ZF)(l):(0,a.Mq)())}},2954:function(e,t,s){"use strict";s.d(t,{g:function(){return n}});var a=s(469);async function n(){try{let e=(0,a.v9)().currentUser;if(!e)return{};let t=await e.getIdToken();return{Authorization:"Bearer ".concat(t)}}catch(e){return{}}}},6901:function(e,t,s){"use strict";s.d(t,{X:function(){return r}});var a=s(2954),n=s(2265);function r(){let[e,t]=(0,n.useState)(null),[s,r]=(0,n.useState)(!0),[l,i]=(0,n.useState)(null),u=(0,n.useCallback)(async()=>{i(null),r(!0);try{let e=await (0,a.g)(),s=await fetch("/api/orgs/current",{headers:{...e},credentials:"include"});if(401===s.status||403===s.status){t(null),i("Non autoris\xe9");return}if(404===s.status){t(null),i("Organisation non trouv\xe9e");return}if(!s.ok){t(null),i("Erreur au chargement");return}let n=await s.json();t(n)}catch(e){t(null),i("Erreur r\xe9seau")}finally{r(!1)}},[]);return(0,n.useEffect)(()=>{u()},[u]),{org:e,loading:s,error:l,refetch:u}}},9376:function(e,t,s){"use strict";var a=s(5475);s.o(a,"useParams")&&s.d(t,{useParams:function(){return a.useParams}}),s.o(a,"usePathname")&&s.d(t,{usePathname:function(){return a.usePathname}}),s.o(a,"useRouter")&&s.d(t,{useRouter:function(){return a.useRouter}})}},function(e){e.O(0,[139,685,971,117,744],function(){return e(e.s=4816)}),_N_E=e.O()}]);