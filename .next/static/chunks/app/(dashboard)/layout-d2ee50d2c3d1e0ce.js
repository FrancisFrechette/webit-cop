(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[642],{3798:function(e,t,n){Promise.resolve().then(n.bind(n,4189))},4189:function(e,t,n){"use strict";n.d(t,{default:function(){return o}});var r=n(7437),a=n(7429),s=n(6901),u=n(2954),l=n(2265),i=n(7648),c=n(9376);function o(e){var t;let{children:n}=e,{user:o,loading:f}=(0,a.z)(),{org:d,loading:m}=(0,s.X)(),{me:h}=function(){let[e,t]=(0,l.useState)(null),[n,r]=(0,l.useState)(!0),[a,s]=(0,l.useState)(null),i=(0,l.useCallback)(async()=>{s(null),r(!0);try{let e=await (0,u.g)(),n=await fetch("/api/orgs/current/me",{headers:{...e},credentials:"include"});if(401===n.status||403===n.status){t(null),s("Non autoris\xe9");return}if(!n.ok){t(null),s("Erreur au chargement");return}let r=await n.json();t(r)}catch(e){t(null),s("Erreur au chargement")}finally{r(!1)}},[]);return(0,l.useEffect)(()=>{i()},[i]),{me:e,loading:n,error:a,refetch:i}}(),x=(0,c.useRouter)(),g=(0,c.usePathname)();(0,l.useEffect)(()=>{f||o||x.replace("/login?next=".concat(encodeURIComponent(g||"/pages")))},[o,f,x,g]);let E=o&&!m;return f?(0,r.jsx)("div",{className:"flex min-h-screen items-center justify-center bg-[#050816]",children:(0,r.jsx)("p",{className:"text-webit-fg-muted",children:"Chargementâ€¦"})}):o?(0,r.jsxs)("div",{className:"min-h-screen bg-[#050816] text-webit-fg",children:[(0,r.jsx)("header",{className:"border-b border-webit-panel-border",children:(0,r.jsxs)("div",{className:"layout-container flex h-14 items-center justify-between gap-4",children:[(0,r.jsxs)("div",{className:"flex items-center gap-6",children:[(0,r.jsx)(i.default,{href:"/pages",className:"text-sm font-semibold text-white hover:text-webit-accent",children:"Webit COP"}),(0,r.jsxs)("nav",{className:"flex gap-4",children:[(0,r.jsx)(i.default,{href:"/pages",className:"text-sm text-webit-fg-muted hover:text-webit-accent",children:"Pages"}),(0,r.jsx)(i.default,{href:"/articles",className:"text-sm text-webit-fg-muted hover:text-webit-accent",children:"Articles"}),(0,r.jsx)(i.default,{href:"/calendar",className:"text-sm text-webit-fg-muted hover:text-webit-accent",children:"Calendrier"}),(null==h?void 0:h.canManageMembers)&&(0,r.jsx)(i.default,{href:"/org/members",className:"text-sm text-webit-fg-muted hover:text-webit-accent",children:"Membres & r\xf4les"})]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-4 text-sm",children:[E&&(0,r.jsxs)("span",{className:"text-webit-fg-muted",children:["Organisation : ",null!==(t=null==d?void 0:d.name)&&void 0!==t?t:"Organisation inconnue"]}),h&&(0,r.jsxs)("span",{className:"text-webit-fg-muted",title:"R\xf4le dans cette organisation",children:["Vous : ",h.orgRole]}),(0,r.jsx)("span",{className:"text-webit-fg-muted",children:o.displayName||o.email||o.uid}),(0,r.jsx)(i.default,{href:"/logout",className:"text-webit-fg-muted hover:text-webit-accent-rose",children:"D\xe9connexion"})]})]})}),n]}):null}},469:function(e,t,n){"use strict";n.d(t,{v9:function(){return l}});var r=n(738),a=n(3301),s=n(257);let u={apiKey:s.env.NEXT_PUBLIC_FIREBASE_API_KEY,authDomain:s.env.NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN,projectId:s.env.NEXT_PUBLIC_FIREBASE_PROJECT_ID,storageBucket:s.env.NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET,messagingSenderId:s.env.NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID,appId:s.env.NEXT_PUBLIC_FIREBASE_APP_ID};function l(){return(0,a.v0)(0===(0,r.C6)().length?(0,r.ZF)(u):(0,r.Mq)())}},2954:function(e,t,n){"use strict";n.d(t,{g:function(){return a}});var r=n(469);async function a(){try{let e=(0,r.v9)().currentUser;if(!e)return{};let t=await e.getIdToken();return{Authorization:"Bearer ".concat(t)}}catch(e){return{}}}},7429:function(e,t,n){"use strict";n.d(t,{z:function(){return s}});var r=n(2265),a=n(469);function s(){let[e,t]=(0,r.useState)(null),[n,s]=(0,r.useState)(!0),[u,l]=(0,r.useState)(null);return(0,r.useEffect)(()=>{let e=(0,a.v9)().onAuthStateChanged(e=>{t(null!=e?e:null),l(null),s(!1)},e=>{l(e instanceof Error?e:Error(String(e))),t(null),s(!1)});return()=>e()},[]),{user:e,loading:n,error:u}}},6901:function(e,t,n){"use strict";n.d(t,{X:function(){return s}});var r=n(2954),a=n(2265);function s(){let[e,t]=(0,a.useState)(null),[n,s]=(0,a.useState)(!0),[u,l]=(0,a.useState)(null),i=(0,a.useCallback)(async()=>{l(null),s(!0);try{let e=await (0,r.g)(),n=await fetch("/api/orgs/current",{headers:{...e},credentials:"include"});if(401===n.status||403===n.status){t(null),l("Non autoris\xe9");return}if(404===n.status){t(null),l("Organisation non trouv\xe9e");return}if(!n.ok){t(null),l("Erreur au chargement");return}let a=await n.json();t(a)}catch(e){t(null),l("Erreur r\xe9seau")}finally{s(!1)}},[]);return(0,a.useEffect)(()=>{i()},[i]),{org:e,loading:n,error:u,refetch:i}}},7648:function(e,t,n){"use strict";n.d(t,{default:function(){return a.a}});var r=n(2972),a=n.n(r)},9376:function(e,t,n){"use strict";var r=n(5475);n.o(r,"useParams")&&n.d(t,{useParams:function(){return r.useParams}}),n.o(r,"usePathname")&&n.d(t,{usePathname:function(){return r.usePathname}}),n.o(r,"useRouter")&&n.d(t,{useRouter:function(){return r.useRouter}})}},function(e){e.O(0,[139,685,972,971,117,744],function(){return e(e.s=3798)}),_N_E=e.O()}]);