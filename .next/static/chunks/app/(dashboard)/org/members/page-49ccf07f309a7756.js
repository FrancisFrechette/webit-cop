(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[208],{5165:function(e,t,r){Promise.resolve().then(r.bind(r,7638))},7638:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return i}});var a=r(7437),s=r(2265),n=r(2954);let l=["owner","admin","editor","author","viewer"];function i(){let[e,t]=(0,s.useState)([]),[r,i]=(0,s.useState)(!0),[o,c]=(0,s.useState)(null),[d,u]=(0,s.useState)(""),[m,h]=(0,s.useState)("editor"),[b,p]=(0,s.useState)(!1),[x,f]=(0,s.useState)(null),w=(0,s.useCallback)(async()=>{c(null),i(!0);try{var e,r;let a=await (0,n.g)(),s=await fetch("/api/orgs/current/members",{headers:{...a},credentials:"include"});if(403===s.status){let r=await s.json().catch(()=>({}));c(null!==(e=r.error)&&void 0!==e?e:"Vous n’avez pas les droits pour g\xe9rer les membres."),t([]);return}if(!s.ok){c("Erreur au chargement des membres."),t([]);return}let l=await s.json();t(null!==(r=l.members)&&void 0!==r?r:[])}catch(e){c("Erreur au chargement des membres."),t([])}finally{i(!1)}},[]);(0,s.useEffect)(()=>{w()},[w]);let g=async e=>{e.preventDefault();let t=d.trim().toLowerCase();if(t){p(!0),f(null);try{let e=await (0,n.g)(),a=await fetch("/api/orgs/current/members",{method:"POST",headers:{...e,"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({userEmail:t,role:m})}),s=await a.json().catch(()=>({}));if(!a.ok){var r;f(null!==(r=s.error)&&void 0!==r?r:"Erreur lors de l’ajout.");return}u(""),h("editor"),f("Membre ajout\xe9."),w()}catch(e){f("Erreur lors de l’ajout.")}finally{p(!1)}}},j=async(t,r)=>{let a=e.find(e=>e.userId===t);if(a)try{let e=await (0,n.g)(),t=await fetch("/api/orgs/current/members",{method:"POST",headers:{...e,"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({userEmail:a.userEmail,role:r,userId:a.userId,userDisplayName:a.userDisplayName})});if(!t.ok){var s;let e=await t.json().catch(()=>({}));f(null!==(s=e.error)&&void 0!==s?s:"Erreur lors du changement de r\xf4le.");return}f(null),w()}catch(e){f("Erreur lors du changement de r\xf4le.")}},N=async e=>{if(!confirm("Retirer ce membre de l’organisation ?"))return;let t=e.userId||e.userEmail;if(t)try{let e=await (0,n.g)(),a=await fetch("/api/orgs/current/members/".concat(encodeURIComponent(t)),{method:"DELETE",headers:{...e},credentials:"include"}),s=await a.json().catch(()=>({}));if(!a.ok){var r;f(null!==(r=s.error)&&void 0!==r?r:"Erreur lors de la suppression.");return}f(null),w()}catch(e){f("Erreur lors de la suppression.")}};return r?(0,a.jsx)("div",{className:"layout-container py-12",children:(0,a.jsx)("p",{className:"text-webit-fg-muted",children:"Chargement des membres…"})}):o?(0,a.jsx)("div",{className:"layout-container py-12",children:(0,a.jsx)("p",{className:"text-webit-fg-muted",children:o})}):(0,a.jsxs)("div",{className:"layout-container py-12",children:[(0,a.jsx)("h1",{className:"text-2xl font-semibold text-white",children:"Membres de l’organisation"}),(0,a.jsx)("p",{className:"mt-1 text-sm text-webit-fg-muted",children:"Owner est le r\xf4le le plus \xe9lev\xe9. Ne retirez pas le dernier owner."}),x&&(0,a.jsx)("div",{className:"mt-4 rounded border border-webit-panel-border bg-slate-800/60 px-4 py-2 text-sm text-white",children:x}),(0,a.jsxs)("form",{onSubmit:g,className:"mt-6 flex flex-wrap items-end gap-4 rounded border border-webit-panel-border bg-slate-800/40 p-4",children:[(0,a.jsxs)("label",{className:"flex flex-col gap-1",children:[(0,a.jsx)("span",{className:"text-sm text-webit-fg-muted",children:"Email"}),(0,a.jsx)("input",{type:"email",value:d,onChange:e=>u(e.target.value),placeholder:"editor@example.com",className:"w-56 rounded border border-webit-panel-border bg-slate-800/60 px-3 py-2 text-white placeholder:text-webit-fg-muted focus:border-webit-accent focus:outline-none"})]}),(0,a.jsxs)("label",{className:"flex flex-col gap-1",children:[(0,a.jsx)("span",{className:"text-sm text-webit-fg-muted",children:"R\xf4le"}),(0,a.jsx)("select",{value:m,onChange:e=>h(e.target.value),className:"rounded border border-webit-panel-border bg-slate-800/60 px-3 py-2 text-white focus:border-webit-accent focus:outline-none",children:l.map(e=>(0,a.jsx)("option",{value:e,children:e},e))})]}),(0,a.jsx)("button",{type:"submit",disabled:b||!d.trim(),className:"rounded bg-webit-accent/20 px-4 py-2 text-sm font-medium text-white hover:bg-webit-accent/30 disabled:opacity-50",children:b?"Ajout…":"Ajouter / inviter"})]}),(0,a.jsx)("div",{className:"mt-8 overflow-x-auto rounded border border-webit-panel-border",children:(0,a.jsxs)("table",{className:"w-full min-w-[400px] text-left text-sm",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{className:"border-b border-webit-panel-border bg-slate-800/60",children:[(0,a.jsx)("th",{className:"p-3 font-medium text-white",children:"Email"}),(0,a.jsx)("th",{className:"p-3 font-medium text-white",children:"Nom affich\xe9"}),(0,a.jsx)("th",{className:"p-3 font-medium text-white",children:"R\xf4le"}),(0,a.jsx)("th",{className:"p-3 font-medium text-white",children:"Actions"})]})}),(0,a.jsx)("tbody",{children:0===e.length?(0,a.jsx)("tr",{children:(0,a.jsx)("td",{colSpan:4,className:"p-4 text-webit-fg-muted",children:"Aucun membre. Ajoutez un membre par email ci-dessus."})}):e.map(e=>{var t;return(0,a.jsxs)("tr",{className:"border-b border-webit-panel-border/60",children:[(0,a.jsx)("td",{className:"p-3 text-white",children:e.userEmail}),(0,a.jsx)("td",{className:"p-3 text-webit-fg-muted",children:null!==(t=e.userDisplayName)&&void 0!==t?t:"—"}),(0,a.jsx)("td",{className:"p-3",children:(0,a.jsx)("select",{value:e.role,onChange:t=>j(e.userId,t.target.value),className:"rounded border border-webit-panel-border bg-slate-800/60 px-2 py-1 text-white focus:border-webit-accent focus:outline-none",children:l.map(e=>(0,a.jsx)("option",{value:e,children:e},e))})}),(0,a.jsx)("td",{className:"p-3",children:(0,a.jsx)("button",{type:"button",onClick:()=>N(e),className:"text-sm text-webit-fg-muted hover:text-red-400",children:"Retirer"})})]},e.userId||e.userEmail)})})]})})]})}},469:function(e,t,r){"use strict";r.d(t,{v9:function(){return i}});var a=r(738),s=r(3301),n=r(257);let l={apiKey:n.env.NEXT_PUBLIC_FIREBASE_API_KEY,authDomain:n.env.NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN,projectId:n.env.NEXT_PUBLIC_FIREBASE_PROJECT_ID,storageBucket:n.env.NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET,messagingSenderId:n.env.NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID,appId:n.env.NEXT_PUBLIC_FIREBASE_APP_ID};function i(){return(0,s.v0)(0===(0,a.C6)().length?(0,a.ZF)(l):(0,a.Mq)())}},2954:function(e,t,r){"use strict";r.d(t,{g:function(){return s}});var a=r(469);async function s(){try{let e=(0,a.v9)().currentUser;if(!e)return{};let t=await e.getIdToken();return{Authorization:"Bearer ".concat(t)}}catch(e){return{}}}}},function(e){e.O(0,[139,685,971,117,744],function(){return e(e.s=5165)}),_N_E=e.O()}]);